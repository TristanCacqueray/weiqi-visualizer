var mt=Object.defineProperty;var gt=(h,t,i)=>t in h?mt(h,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[t]=i;var z=(h,t,i)=>gt(h,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const e={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,QUERY_COUNTER_BITS_EXT:34916,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795,TEXTURE_MAX_ANISOTROPY_EXT:34046,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,COMPLETION_STATUS_KHR:37297,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853},w={[e.BYTE]:1,[e.UNSIGNED_BYTE]:1,[e.SHORT]:2,[e.UNSIGNED_SHORT]:2,[e.INT]:4,[e.UNSIGNED_INT]:4,[e.FLOAT]:4},st={[e.R8]:[e.RED,e.UNSIGNED_BYTE],[e.R8_SNORM]:[e.RED,e.BYTE],[e.R16F]:[e.RED,e.FLOAT],[e.R32F]:[e.RED,e.FLOAT],[e.R8UI]:[e.RED_INTEGER,e.UNSIGNED_BYTE],[e.R8I]:[e.RED_INTEGER,e.BYTE],[e.R16UI]:[e.RED_INTEGER,e.UNSIGNED_SHORT],[e.R16I]:[e.RED_INTEGER,e.SHORT],[e.R32UI]:[e.RED_INTEGER,e.UNSIGNED_INT],[e.R32I]:[e.RED_INTEGER,e.INT],[e.RG8]:[e.RG,e.UNSIGNED_BYTE],[e.RG8_SNORM]:[e.RG,e.BYTE],[e.RG16F]:[e.RG,e.FLOAT],[e.RG32F]:[e.RG,e.FLOAT],[e.RG8UI]:[e.RG_INTEGER,e.UNSIGNED_BYTE],[e.RG8I]:[e.RG_INTEGER,e.BYTE],[e.RG16UI]:[e.RG_INTEGER,e.UNSIGNED_SHORT],[e.RG16I]:[e.RG_INTEGER,e.SHORT],[e.RG32UI]:[e.RG_INTEGER,e.UNSIGNED_INT],[e.RG32I]:[e.RG_INTEGER,e.INT],[e.RGB8]:[e.RGB,e.UNSIGNED_BYTE],[e.SRGB8]:[e.RGB,e.UNSIGNED_BYTE],[e.RGB565]:[e.RGB,e.UNSIGNED_SHORT_5_6_5],[e.RGB8_SNORM]:[e.RGB,e.BYTE],[e.R11F_G11F_B10F]:[e.RGB,e.UNSIGNED_INT_10F_11F_11F_REV],[e.RGB9_E5]:[e.RGB,e.UNSIGNED_INT_5_9_9_9_REV],[e.RGB16F]:[e.RGB,e.FLOAT],[e.RGB32F]:[e.RGB,e.FLOAT],[e.RGB8UI]:[e.RGB_INTEGER,e.UNSIGNED_BYTE],[e.RGB8I]:[e.RGB_INTEGER,e.BYTE],[e.RGB16UI]:[e.RGB_INTEGER,e.UNSIGNED_SHORT],[e.RGB16I]:[e.RGB_INTEGER,e.SHORT],[e.RGB32UI]:[e.RGB_INTEGER,e.UNSIGNED_INT],[e.RGB32I]:[e.RGB_INTEGER,e.INT],[e.RGBA8]:[e.RGBA,e.UNSIGNED_BYTE],[e.SRGB8_ALPHA8]:[e.RGBA,e.UNSIGNED_BYTE],[e.RGBA8_SNORM]:[e.RGBA,e.BYTE],[e.RGB5_A1]:[e.RGBA,e.UNSIGNED_SHORT_5_5_5_1],[e.RGBA4]:[e.RGBA,e.UNSIGNED_SHORT_4_4_4_4],[e.RGB10_A2]:[e.RGBA,e.UNSIGNED_INT_2_10_10_10_REV],[e.RGBA16F]:[e.RGBA,e.FLOAT],[e.RGBA32F]:[e.RGBA,e.FLOAT],[e.RGBA8UI]:[e.RGBA_INTEGER,e.UNSIGNED_BYTE],[e.RGBA8I]:[e.RGBA_INTEGER,e.BYTE],[e.RGB10_A2UI]:[e.RGBA_INTEGER,e.UNSIGNED_INT_2_10_10_10_REV],[e.RGBA16UI]:[e.RGBA_INTEGER,e.UNSIGNED_SHORT],[e.RGBA16I]:[e.RGBA_INTEGER,e.SHORT],[e.RGBA32I]:[e.RGBA_INTEGER,e.INT],[e.RGBA32UI]:[e.RGBA_INTEGER,e.UNSIGNED_INT],[e.DEPTH_COMPONENT16]:[e.DEPTH_COMPONENT,e.UNSIGNED_SHORT],[e.DEPTH_COMPONENT24]:[e.DEPTH_COMPONENT,e.UNSIGNED_INT],[e.DEPTH_COMPONENT32F]:[e.DEPTH_COMPONENT,e.FLOAT],[e.DEPTH24_STENCIL8]:[e.DEPTH_STENCIL,e.UNSIGNED_INT_24_8],[e.DEPTH32F_STENCIL8]:[e.DEPTH_STENCIL,e.FLOAT_32_UNSIGNED_INT_24_8_REV]},v={[e.COMPRESSED_RGB_S3TC_DXT1_EXT]:!0,[e.COMPRESSED_RGBA_S3TC_DXT1_EXT]:!0,[e.COMPRESSED_RGBA_S3TC_DXT3_EXT]:!0,[e.COMPRESSED_RGBA_S3TC_DXT5_EXT]:!0,[e.COMPRESSED_SRGB_S3TC_DXT1_EXT]:!0,[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:!0,[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:!0,[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:!0,[e.COMPRESSED_R11_EAC]:!0,[e.COMPRESSED_SIGNED_R11_EAC]:!0,[e.COMPRESSED_RG11_EAC]:!0,[e.COMPRESSED_SIGNED_RG11_EAC]:!0,[e.COMPRESSED_RGB8_ETC2]:!0,[e.COMPRESSED_SRGB8_ETC2]:!0,[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[e.COMPRESSED_RGBA8_ETC2_EAC]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:!0,[e.COMPRESSED_RGBA_ASTC_4x4_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_5x4_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_5x5_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_6x5_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_6x6_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_8x5_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_8x6_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_8x8_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_10x5_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_10x6_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_10x8_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_10x10_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_12x10_KHR]:!0,[e.COMPRESSED_RGBA_ASTC_12x12_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]:!0,[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]:!0,[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:!0,[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:!0,[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:!0,[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:!0},c={},H=new Array(1),F={},nt={[e.UNSIGNED_BYTE]:{[e.RED]:e.R8,[e.RG]:e.RG8,[e.RGB]:e.RGB8,[e.RGBA]:e.RGBA8},[e.UNSIGNED_SHORT]:{[e.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[e.FLOAT]:{[e.RED]:e.R16F,[e.RG]:e.RG16F,[e.RGB]:e.RGB16F,[e.RGBA]:e.RGBA16F,[e.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F}};class Nt{constructor(t,i,r){if(this.gl=t,this.texture=null,this.appState=i,this.compressed=v[r.internalFormat],r.format!==void 0&&(console.warn("Cubemap option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!v[r.format],r.type===void 0&&(r.type=r.format===e.DEPTH_COMPONENT?e.UNSIGNED_SHORT:e.UNSIGNED_BYTE),r.internalFormat===void 0&&(this.compressed?r.internalFormat=r.format:r.internalFormat=nt[r.type][r.format])),this.compressed)this.internalFormat=r.internalFormat,this.format=r.internalFormat,this.type=e.UNSIGNED_BYTE;else{this.internalFormat=r.internalFormat!==void 0?r.internalFormat:e.RGBA8;let p=st[this.internalFormat];this.format=p[0],this.type=r.type!==void 0?r.type:p[1]}this.currentUnit=-1;let s=Array.isArray(r.negX),n=s?r.negX[0]:r.negX,{width:l=n.width,height:a=n.height,flipY:o=!1,premultiplyAlpha:E=!1,minFilter:_=n?e.LINEAR_MIPMAP_NEAREST:e.NEAREST,magFilter:u=n?e.LINEAR:e.NEAREST,wrapS:T=e.REPEAT,wrapT:f=e.REPEAT,compareMode:x=e.NONE,compareFunc:d=e.LEQUAL,minLOD:m=null,maxLOD:N=null,baseLevel:C=null,maxLevel:B=null,maxAnisotropy:D=1}=r;this.width=l,this.height=a,this.flipY=o,this.premultiplyAlpha=E,this.minFilter=_,this.magFilter=u,this.wrapS=T,this.wrapT=f,this.compareMode=x,this.compareFunc=d,this.minLOD=m,this.maxLOD=N,this.baseLevel=C,this.maxLevel=B,this.maxAnisotropy=Math.min(D,c.MAX_TEXTURE_ANISOTROPY),this.mipmaps=_===e.LINEAR_MIPMAP_NEAREST||_===e.LINEAR_MIPMAP_LINEAR,this.miplevelsProvided=s&&r.negX.length>1,this.levels=this.mipmaps?Math.floor(Math.log2(Math.min(this.width,this.height)))+1:1,this.restore(r)}restore(t=F){this.texture=this.gl.createTexture(),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.bind(0),this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,this.compareMode),this.baseLevel!==null&&this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAX_LEVEL,this.maxLevel),this.minLOD!==null&&this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAX_LOD,this.maxLOD),this.maxAnisotropy>1&&this.gl.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy),this.gl.texStorage2D(e.TEXTURE_CUBE_MAP,this.levels,this.internalFormat,this.width,this.height);let{negX:i,posX:r,negY:s,posY:n,negZ:l,posZ:a}=t;return i&&(this.faceData(e.TEXTURE_CUBE_MAP_NEGATIVE_X,i),this.faceData(e.TEXTURE_CUBE_MAP_POSITIVE_X,r),this.faceData(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,s),this.faceData(e.TEXTURE_CUBE_MAP_POSITIVE_Y,n),this.faceData(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,l),this.faceData(e.TEXTURE_CUBE_MAP_POSITIVE_Z,a)),this.mipmaps&&!this.miplevelsProvided&&this.gl.generateMipmap(e.TEXTURE_CUBE_MAP),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1),this}faceData(t,i){Array.isArray(i)||(H[0]=i,i=H);let r=this.mipmaps?i.length:1,s=this.width,n=this.height,l;if(this.gl.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)for(l=0;l<r;++l)this.gl.compressedTexSubImage2D(t,l,0,0,s,n,this.format,i[l]),s=Math.max(s>>1,1),n=Math.max(n>>1,1);else for(l=0;l<r;++l)this.gl.texSubImage2D(t,l,0,0,s,n,this.format,this.type,i[l]),s=Math.max(s>>1,1),n=Math.max(n>>1,1);return this}bind(t){let i=this.appState.textures[t];return this.appState.activeTexture!==t&&(this.gl.activeTexture(e.TEXTURE0+t),this.appState.activeTexture=t),i!==this&&(i&&(i.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[t]=this,this.currentUnit=t),this}}class Ct{constructor(t,i,r,s=null,n){this.gl=t,this.currentProgram=r,this.drawPrimitive=e.TRIANGLES,this.currentVertexArray=s,this.currentTransformFeedback=null,this.appState=i,this.uniformIndices={},this.uniformNames=new Array(c.MAX_UNIFORMS),this.uniformValues=new Array(c.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(c.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(c.MAX_UNIFORM_BUFFERS),this.uniformBlockCount=0,this.textures=new Array(c.MAX_TEXTURE_UNITS),this.textureCount=0,this.offsets=new Int32Array(1),this.numElements=new Int32Array(1),this.numInstances=new Int32Array(1),this.numDraws=1,this.drawCountsFromVertexArray=!0,n!==void 0&&(console.warn("Primitive argument to 'App.createDrawCall' is deprecated and will be removed. Use 'DrawCall.primitive' instead."),this.primitive(n))}primitive(t){return this.drawPrimitive=t,this}transformFeedback(t){return this.currentTransformFeedback=t,this}uniform(t,i){let r=this.uniformIndices[t];return r===void 0&&(r=this.uniformCount++,this.uniformIndices[t]=r,this.uniformNames[r]=t),this.uniformValues[r]=i,this}texture(t,i){let r=this.currentProgram.samplers[t];return this.textures[r]=i,this}uniformBlock(t,i){let r=this.currentProgram.uniformBlocks[t];return this.uniformBuffers[r]=i,this}drawRanges(...t){this.numDraws=t.length,this.offsets.length<this.numDraws&&(this.offsets=new Int32Array(this.numDraws)),this.numElements.length<this.numDraws&&(this.numElements=new Int32Array(this.numDraws)),this.numInstances.length<this.numDraws&&(this.numInstances=new Int32Array(this.numDraws));for(let i=0;i<this.numDraws;++i){let r=t[i];this.offsets[i]=r[0],this.numElements[i]=r[1],this.numInstances[i]=r[2]||1}return this.drawCountsFromVertexArray=!1,this}draw(){let t=this.uniformNames,i=this.uniformValues,r=this.uniformBuffers,s=this.currentProgram.uniformBlockCount,n=this.textures,l=this.currentProgram.samplerCount,a=!1;this.currentProgram.bind(),this.currentVertexArray&&(this.currentVertexArray.bind(),a=this.currentVertexArray.indexed,this.drawCountsFromVertexArray&&(this.numElements[0]=this.currentVertexArray.numElements,this.numInstances[0]=this.currentVertexArray.numInstances));for(let o=0;o<this.uniformCount;++o)this.currentProgram.uniform(t[o],i[o]);for(let o=0;o<s;++o)r[o].bind(o);for(let o=0;o<l;++o)n[o].bind(o);if(this.currentTransformFeedback?(this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.drawPrimitive)):this.appState.transformFeedback&&(this.gl.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null),c.MULTI_DRAW_INSTANCED){let o=this.appState.extensions.multiDrawInstanced;a?o.multiDrawElementsInstancedWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.numDraws):o.multiDrawArraysInstancedWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.numDraws)}else if(a)for(let o=0;o<this.numDraws;++o)this.gl.drawElementsInstanced(this.drawPrimitive,this.numElements[o],this.currentVertexArray.indexType,this.offsets[o],this.numInstances[o]);else for(let o=0;o<this.numDraws;++o)this.gl.drawArraysInstanced(this.drawPrimitive,this.offsets[o],this.numElements[o],this.numInstances[o]);return this.currentTransformFeedback&&this.gl.endTransformFeedback(),this}}class L{constructor(t,i,r,s,n=s.width,l=s.height,a,o,E=F){if(this.gl=t,this.binding=r,this.texture=null,this.width=n||0,this.height=l||0,this.depth=a||0,this.is3D=o,this.appState=i,this.compressed=!!v[E.internalFormat],E.format!==void 0&&(console.warn("Texture option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!v[E.format],E.type===void 0&&(E.type=E.format===e.DEPTH_COMPONENT?e.UNSIGNED_SHORT:e.UNSIGNED_BYTE),E.internalFormat===void 0&&(this.compressed?E.internalFormat=E.format:E.internalFormat=nt[E.type][E.format])),this.compressed)this.internalFormat=E.internalFormat,this.format=this.internalFormat,this.type=e.UNSIGNED_BYTE;else{this.internalFormat=E.internalFormat!==void 0?E.internalFormat:e.RGBA8;let W=st[this.internalFormat];this.format=W[0],this.type=E.type!==void 0?E.type:W[1]}this.currentUnit=-1;let{minFilter:_=s?e.LINEAR_MIPMAP_NEAREST:e.NEAREST,magFilter:u=s?e.LINEAR:e.NEAREST,wrapS:T=e.REPEAT,wrapT:f=e.REPEAT,wrapR:x=e.REPEAT,compareMode:d=e.NONE,compareFunc:m=e.LEQUAL,minLOD:N=null,maxLOD:C=null,baseLevel:B=null,maxLevel:D=null,maxAnisotropy:p=1,flipY:G=!1,premultiplyAlpha:xt=!1}=E;this.minFilter=_,this.magFilter=u,this.wrapS=T,this.wrapT=f,this.wrapR=x,this.compareMode=d,this.compareFunc=m,this.minLOD=N,this.maxLOD=C,this.baseLevel=B,this.maxLevel=D,this.maxAnisotropy=Math.min(p,c.MAX_TEXTURE_ANISOTROPY),this.flipY=G,this.premultiplyAlpha=xt,this.mipmaps=_===e.LINEAR_MIPMAP_NEAREST||_===e.LINEAR_MIPMAP_LINEAR,this.restore(s)}restore(t){return this.texture=null,this.resize(this.width,this.height,this.depth),t&&this.data(t),this}resize(t,i,r){if(r=r||0,this.texture&&t===this.width&&i===this.height&&r===this.depth)return this;this.gl.deleteTexture(this.texture),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.texture=this.gl.createTexture(),this.bind(Math.max(this.currentUnit,0)),this.width=t,this.height=i,this.depth=r,this.gl.texParameteri(this.binding,e.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(this.binding,e.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(this.binding,e.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(this.binding,e.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(this.binding,e.TEXTURE_WRAP_R,this.wrapR),this.gl.texParameteri(this.binding,e.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(this.binding,e.TEXTURE_COMPARE_MODE,this.compareMode),this.minLOD!==null&&this.gl.texParameterf(this.binding,e.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameterf(this.binding,e.TEXTURE_MAX_LOD,this.maxLOD),this.baseLevel!==null&&this.gl.texParameteri(this.binding,e.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(this.binding,e.TEXTURE_MAX_LEVEL,this.maxLevel),this.maxAnisotropy>1&&this.gl.texParameteri(this.binding,e.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);let s;return this.is3D?(this.mipmaps?s=Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:s=1,this.gl.texStorage3D(this.binding,s,this.internalFormat,this.width,this.height,this.depth)):(this.mipmaps?s=Math.floor(Math.log2(Math.max(this.width,this.height)))+1:s=1,this.gl.texStorage2D(this.binding,s,this.internalFormat,this.width,this.height)),this}data(t){Array.isArray(t)||(H[0]=t,t=H);let i=this.mipmaps?t.length:1,r=this.width,s=this.height,n=this.depth,l=this.mipmaps&&t.length===1,a;if(this.bind(Math.max(this.currentUnit,0)),this.gl.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)if(this.is3D)for(a=0;a<i;++a)this.gl.compressedTexSubImage3D(this.binding,a,0,0,0,r,s,n,this.format,t[a]),r=Math.max(r>>1,1),s=Math.max(s>>1,1),n=Math.max(n>>1,1);else for(a=0;a<i;++a)this.gl.compressedTexSubImage2D(this.binding,a,0,0,r,s,this.format,t[a]),r=Math.max(r>>1,1),s=Math.max(s>>1,1);else if(this.is3D)for(a=0;a<i;++a)this.gl.texSubImage3D(this.binding,a,0,0,0,r,s,n,this.format,this.type,t[a]),r=Math.max(r>>1,1),s=Math.max(s>>1,1),n=Math.max(n>>1,1);else for(a=0;a<i;++a)this.gl.texSubImage2D(this.binding,a,0,0,r,s,this.format,this.type,t[a]),r=Math.max(r>>1,1),s=Math.max(s>>1,1);return l&&this.gl.generateMipmap(this.binding),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.currentUnit!==-1&&this.appState.textures[this.currentUnit]===this&&(this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)),this}bind(t){let i=this.appState.textures[t];return this.appState.activeTexture!==t&&(this.gl.activeTexture(e.TEXTURE0+t),this.appState.activeTexture=t),i!==this&&(i&&(i.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(this.binding,this.texture),this.appState.textures[t]=this,this.currentUnit=t),this}}class k{constructor(t,i,r,s,n=0){this.gl=t,this.renderbuffer=null,this.width=i,this.height=r,this.internalFormat=s,this.samples=n,this.restore()}restore(){return this.renderbuffer=this.gl.createRenderbuffer(),this.resize(this.width,this.height),this}resize(t,i){return this.width=t,this.height=i,this.gl.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorageMultisample(e.RENDERBUFFER,this.samples,this.internalFormat,this.width,this.height),this.gl.bindRenderbuffer(e.RENDERBUFFER,null),this}delete(){return this.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null,this}}class pt{constructor(t,i){this.gl=t,this.framebuffer=null,this.appState=i,this.numColorTargets=0,this.colorAttachments=[],this.colorAttachmentEnums=[],this.colorAttachmentTargets=[],this.depthAttachment=null,this.depthAttachmentTarget=null,this.width=0,this.height=0,this.restore()}restore(){let t=this.appState.framebuffers;for(let i in t)t[i]===this&&(t[i]=null);return this.framebuffer=this.gl.createFramebuffer(),this}colorTarget(t,i,r=i.is3D?0:e.TEXTURE_2D){if(t>=this.numColorTargets){let l=t+1;this.colorAttachmentEnums.length=l,this.colorAttachments.length=l,this.colorAttachmentTargets.length=l;for(let a=this.numColorTargets;a<l-1;++a)this.colorAttachmentEnums[a]=e.NONE,this.colorAttachments[a]=null,this.colorAttachmentTargets[a]=0;this.numColorTargets=l}this.colorAttachmentEnums[t]=e.COLOR_ATTACHMENT0+t,this.colorAttachments[t]=i,this.colorAttachmentTargets[t]=r;let s=this.bindAndCaptureState(),n=this.appState.drawFramebufferBinding;return i instanceof k?this.gl.framebufferRenderbuffer(n,this.colorAttachmentEnums[t],e.RENDERBUFFER,i.renderbuffer):i.is3D?this.gl.framebufferTextureLayer(n,this.colorAttachmentEnums[t],i.texture,0,r):this.gl.framebufferTexture2D(n,this.colorAttachmentEnums[t],r,i.texture,0),this.gl.drawBuffers(this.colorAttachmentEnums),this.width=i.width,this.height=i.height,this.restoreState(s),this}depthTarget(t,i=t.is3D?0:e.TEXTURE_2D){let r=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;return this.depthAttachment=t,this.depthAttachmentTarget=i,t instanceof k?this.gl.framebufferRenderbuffer(s,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.renderbuffer):t.is3D?this.gl.framebufferTextureLayer(s,e.DEPTH_ATTACHMENT,t.texture,0,i):this.gl.framebufferTexture2D(s,e.DEPTH_ATTACHMENT,i,t.texture,0),this.width=t.width,this.height=t.height,this.restoreState(r),this}resize(t=this.gl.drawingBufferWidth,i=this.gl.drawingBufferHeight){let r=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;for(let n=0;n<this.numColorTargets;++n){let l=this.colorAttachments[n];l&&(l.resize(t,i),l instanceof L&&(l.is3D?this.gl.framebufferTextureLayer(s,this.colorAttachmentEnums[n],l.texture,0,this.colorAttachmentTargets[n]):this.gl.framebufferTexture2D(s,this.colorAttachmentEnums[n],this.colorAttachmentTargets[n],l.texture,0)))}return this.depthAttachment&&(this.depthAttachment.resize(t,i),this.depthAttachment instanceof L&&(this.depthAttachment.is3D?this.gl.framebufferTextureLayer(s,e.DEPTH_ATTACHMENT,this.depthAttachment.texture,0,this.depthAttachmentTarget):this.gl.framebufferTexture2D(s,e.DEPTH_ATTACHMENT,this.depthAttachmentTarget,this.depthAttachment.texture,0))),this.width=t,this.height=i,this.restoreState(r),this}delete(){if(this.framebuffer){this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null;let t=this.appState.framebuffers;for(let i in t)t[i]===this&&(this.gl.bindFramebuffer(i,null),t[i]=null)}return this}getStatus(){let t=this.bindAndCaptureState(),i=this.appState.drawFramebufferBinding,r=this.gl.checkFramebufferStatus(i);return this.restoreState(t),r}bindForDraw(){let t=this.appState.drawFramebufferBinding,i=this.appState.framebuffers;return i[t]!==this&&(this.gl.bindFramebuffer(t,this.framebuffer),i[t]=this),this}bindForRead(){let t=this.appState.readFramebufferBinding,i=this.appState.framebuffers;return i[t]!==this&&(this.gl.bindFramebuffer(t,this.framebuffer),i[t]=this),this}bindAndCaptureState(){let t=this.appState.drawFramebufferBinding,i=this.appState.framebuffers[t];return i!==this&&this.gl.bindFramebuffer(t,this.framebuffer),i}restoreState(t){if(t!==this){let i=this.appState.drawFramebufferBinding;this.gl.bindFramebuffer(i,t?t.framebuffer:null)}return this}get colorTextures(){return console.error("Framebuffer.colorTextures is deprecated and will be removed. Please use Framebuffer.colorAttachments."),this.colorAttachments}get depthTexture(){return console.error("Framebuffer.depthTexture is deprecated and will be removed. Please use Framebuffer.depthAttachment."),this.depthAttachment}}class M{constructor(t,i,r,s){this.gl=t,this.appState=i,this.shader=null,this.type=r,this.source=s.trim(),this.restore()}restore(){return this.shader=this.gl.createShader(this.type),this.gl.shaderSource(this.shader,this.source),this.gl.compileShader(this.shader),this}translatedSource(){return c.DEBUG_SHADERS?this.appState.extensions.debugShaders.getTranslatedShaderSource(this.shader):"(Unavailable)"}delete(){return this.shader&&(this.gl.deleteShader(this.shader),this.shader=null),this}checkCompilation(){if(!this.gl.getShaderParameter(this.shader,e.COMPILE_STATUS)){let t,i;for(console.error(this.gl.getShaderInfoLog(this.shader)),i=this.source.split(`
`),t=0;t<i.length;++t)console.error(`${t+1}: ${i[t]}`)}return this}}const A={};A[e.BOOL]="uniform1i";A[e.INT]="uniform1i";A[e.SAMPLER_2D]="uniform1i";A[e.INT_SAMPLER_2D]="uniform1i";A[e.UNSIGNED_INT_SAMPLER_2D]="uniform1i";A[e.SAMPLER_2D_SHADOW]="uniform1i";A[e.SAMPLER_2D_ARRAY]="uniform1i";A[e.INT_SAMPLER_2D_ARRAY]="uniform1i";A[e.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i";A[e.SAMPLER_2D_ARRAY_SHADOW]="uniform1i";A[e.SAMPLER_CUBE]="uniform1i";A[e.INT_SAMPLER_CUBE]="uniform1i";A[e.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i";A[e.SAMPLER_CUBE_SHADOW]="uniform1i";A[e.SAMPLER_3D]="uniform1i";A[e.INT_SAMPLER_3D]="uniform1i";A[e.UNSIGNED_INT_SAMPLER_3D]="uniform1i";A[e.UNSIGNED_INT]="uniform1ui";A[e.FLOAT]="uniform1f";A[e.FLOAT_VEC2]="uniform2f";A[e.FLOAT_VEC3]="uniform3f";A[e.FLOAT_VEC4]="uniform4f";A[e.INT_VEC2]="uniform2i";A[e.INT_VEC3]="uniform3i";A[e.INT_VEC4]="uniform4i";A[e.UNSIGNED_INT_VEC2]="uniform2ui";A[e.UNSIGNED_INT_VEC3]="uniform3ui";A[e.UNSIGNED_INT_VEC4]="uniform4ui";A[e.BOOL_VEC2]="uniform2i";A[e.BOOL_VEC3]="uniform3i";A[e.BOOL_VEC4]="uniform4i";A[e.FLOAT_MAT2]="uniformMatrix2fv";A[e.FLOAT_MAT3]="uniformMatrix3fv";A[e.FLOAT_MAT4]="uniformMatrix4fv";A[e.FLOAT_MAT2x3]="uniformMatrix2x3fv";A[e.FLOAT_MAT2x4]="uniformMatrix2x4fv";A[e.FLOAT_MAT3x2]="uniformMatrix3x2fv";A[e.FLOAT_MAT3x4]="uniformMatrix3x4fv";A[e.FLOAT_MAT4x2]="uniformMatrix4x2fv";A[e.FLOAT_MAT4x3]="uniformMatrix4x3fv";const R={};R[e.BOOL]=1;R[e.INT]=1;R[e.SAMPLER_2D]=1;R[e.INT_SAMPLER_2D]=1;R[e.UNSIGNED_INT_SAMPLER_2D]=1;R[e.SAMPLER_2D_SHADOW]=1;R[e.SAMPLER_2D_ARRAY]=1;R[e.INT_SAMPLER_2D_ARRAY]=1;R[e.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1;R[e.SAMPLER_2D_ARRAY_SHADOW]=1;R[e.SAMPLER_CUBE]=1;R[e.INT_SAMPLER_CUBE]=1;R[e.UNSIGNED_INT_SAMPLER_CUBE]=1;R[e.SAMPLER_CUBE_SHADOW]=1;R[e.SAMPLER_3D]=1;R[e.INT_SAMPLER_3D]=1;R[e.UNSIGNED_INT_SAMPLER_3D]=1;R[e.UNSIGNED_INT]=1;R[e.FLOAT]=1;R[e.FLOAT_VEC2]=2;R[e.FLOAT_VEC3]=3;R[e.FLOAT_VEC4]=4;R[e.INT_VEC2]=2;R[e.INT_VEC3]=3;R[e.INT_VEC4]=4;R[e.UNSIGNED_INT_VEC2]=2;R[e.UNSIGNED_INT_VEC3]=3;R[e.UNSIGNED_INT_VEC4]=4;R[e.BOOL_VEC2]=2;R[e.BOOL_VEC3]=3;R[e.BOOL_VEC4]=4;R[e.FLOAT_MAT2]=4;R[e.FLOAT_MAT3]=9;R[e.FLOAT_MAT4]=16;R[e.FLOAT_MAT2x3]=6;R[e.FLOAT_MAT2x4]=8;R[e.FLOAT_MAT3x2]=6;R[e.FLOAT_MAT3x4]=12;R[e.FLOAT_MAT4x2]=8;R[e.FLOAT_MAT4x3]=12;const S={};S[e.INT]=Int32Array;S[e.SAMPLER_2D]=Int32Array;S[e.INT_SAMPLER_2D]=Int32Array;S[e.UNSIGNED_INT_SAMPLER_2D]=Int32Array;S[e.SAMPLER_2D_SHADOW]=Int32Array;S[e.SAMPLER_2D_ARRAY]=Int32Array;S[e.INT_SAMPLER_2D_ARRAY]=Int32Array;S[e.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array;S[e.SAMPLER_2D_ARRAY_SHADOW]=Int32Array;S[e.SAMPLER_CUBE]=Int32Array;S[e.INT_SAMPLER_CUBE]=Int32Array;S[e.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array;S[e.SAMPLER_CUBE_SHADOW]=Int32Array;S[e.SAMPLER_3D]=Int32Array;S[e.INT_SAMPLER_3D]=Int32Array;S[e.UNSIGNED_INT_SAMPLER_3D]=Int32Array;S[e.UNSIGNED_INT]=Uint32Array;S[e.FLOAT]=Float32Array;S[e.FLOAT_VEC2]=Float32Array;S[e.FLOAT_VEC3]=Float32Array;S[e.FLOAT_VEC4]=Float32Array;S[e.INT_VEC2]=Int32Array;S[e.INT_VEC3]=Int32Array;S[e.INT_VEC4]=Int32Array;S[e.UNSIGNED_INT_VEC2]=Uint32Array;S[e.UNSIGNED_INT_VEC3]=Uint32Array;S[e.UNSIGNED_INT_VEC4]=Uint32Array;class Z{constructor(t,i,r){this.gl=t,this.handle=i,this.glFuncName=A[r],this.cache=r===e.BOOL?!1:0}set(t){this.cache!==t&&(this.gl[this.glFuncName](this.handle,t),this.cache=t)}}class Q{constructor(t,i,r,s){this.gl=t,this.handle=i,this.glFuncName=A[r]+"v",this.count=s,this.cache=new S[r](R[r]*s)}set(t){for(let i=0,r=t.length;i<r;++i)if(this.cache[i]!==t[i]){this.gl[this.glFuncName](this.handle,t),this.cache.set(t);return}}}class ${constructor(t,i,r,s){this.gl=t,this.handle=i,this.glFuncName=A[r]+"v",this.count=s,this.cache=new Array(R[r]*s).fill(!1)}set(t){for(let i=0,r=t.length;i<r;++i)if(this.cache[i]!==t[i]){this.gl[this.glFuncName](this.handle,t);for(let s=i;s<r;s++)this.cache[s]=t[s];return}}}class It{constructor(t,i,r,s){this.gl=t,this.handle=i,this.glFuncName=A[r],this.count=s,this.cache=new Float32Array(R[r]*s)}set(t){for(let i=0,r=t.length;i<r;++i)if(this.cache[i]!==t[i]){this.gl[this.glFuncName](this.handle,!1,t),this.cache.set(t);return}}}class j{constructor(t,i,r,s,n,l,a){this.gl=t,this.appState=i,this.program=null,this.transformFeedbackVaryings=n||null,this.transformFeedbackMode=a||e.SEPARATE_ATTRIBS,this.attributeLocations=l||null,this.uniforms={},this.uniformBlocks={},this.uniformBlockCount=0,this.samplers={},this.samplerCount=0,this.vertexSource=null,this.vertexShader=null,this.fragmentSource=null,this.fragmentShader=null,this.linked=!1,typeof r=="string"?this.vertexSource=r:this.vertexShader=r,typeof s=="string"?this.fragmentSource=s:this.fragmentShader=s,this.initialize()}restore(){return this.initialize(),this.link(),this.checkLinkage(),this}translatedVertexSource(){if(this.vertexShader)return this.vertexShader.translatedSource();{let t=new M(this.gl,this.appState,e.VERTEX_SHADER,this.vertexSource),i=t.translatedSource();return t.delete(),i}}translatedFragmentSource(){if(this.fragmentShader)return this.fragmentShader.translatedSource();{let t=new M(this.gl,this.appState,e.FRAGMENT_SHADER,this.fragmentSource),i=t.translatedSource();return t.delete(),i}}delete(){return this.program&&(this.gl.deleteProgram(this.program),this.program=null,this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null)),this}initialize(){return this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null),this.linked=!1,this.uniformBlockCount=0,this.samplerCount=0,this.vertexSource&&(this.vertexShader=new M(this.gl,this.appState,e.VERTEX_SHADER,this.vertexSource)),this.fragmentSource&&(this.fragmentShader=new M(this.gl,this.appState,e.FRAGMENT_SHADER,this.fragmentSource)),this.program=this.gl.createProgram(),this}link(){if(this.gl.attachShader(this.program,this.vertexShader.shader),this.gl.attachShader(this.program,this.fragmentShader.shader),this.transformFeedbackVaryings&&this.gl.transformFeedbackVaryings(this.program,this.transformFeedbackVaryings,this.transformFeedbackMode),this.attributeLocations)for(let t in this.attributeLocations)this.gl.bindAttribLocation(this.program,this.attributeLocations[t],t);return this.gl.linkProgram(this.program),this}checkCompletion(){return c.PARALLEL_SHADER_COMPILE?this.gl.getProgramParameter(this.program,e.COMPLETION_STATUS_KHR):!0}checkLinkage(){return this.linked?this:(this.gl.getProgramParameter(this.program,e.LINK_STATUS)?(this.linked=!0,this.initVariables()):(console.error(this.gl.getProgramInfoLog(this.program)),this.vertexShader.checkCompilation(),this.fragmentShader.checkCompilation()),this.vertexSource&&(this.vertexShader.delete(),this.vertexShader=null),this.fragmentSource&&(this.fragmentShader.delete(),this.fragmentShader=null),this)}initVariables(){this.bind();let t=this.gl.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),i;for(let s=0;s<t;++s){let n=this.gl.getActiveUniform(this.program,s),l=this.gl.getUniformLocation(this.program,n.name),a=null,o=n.type,E=n.size;switch(o){case e.SAMPLER_2D:case e.INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_2D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE:case e.INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.SAMPLER_CUBE_SHADOW:case e.SAMPLER_3D:case e.INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_3D:i=this.samplerCount++,this.samplers[n.name]=i,this.gl.uniform1i(l,i);break;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:a=E>1?Q:Z;break;case e.BOOL:a=E>1?$:Z;break;case e.FLOAT_VEC2:case e.INT_VEC2:case e.UNSIGNED_INT_VEC2:case e.FLOAT_VEC3:case e.INT_VEC3:case e.UNSIGNED_INT_VEC3:case e.FLOAT_VEC4:case e.INT_VEC4:case e.UNSIGNED_INT_VEC4:a=Q;break;case e.BOOL_VEC2:case e.BOOL_VEC3:case e.BOOL_VEC4:a=$;break;case e.FLOAT_MAT2:case e.FLOAT_MAT3:case e.FLOAT_MAT4:case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:case e.FLOAT_MAT3x2:case e.FLOAT_MAT3x4:case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:a=It;break;default:console.error("Unrecognized type for uniform ",n.name);break}a&&(this.uniforms[n.name]=new a(this.gl,l,o,E))}let r=this.gl.getProgramParameter(this.program,e.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<r;++s){let n=this.gl.getActiveUniformBlockName(this.program,s),l=this.gl.getUniformBlockIndex(this.program,n),a=this.uniformBlockCount++;this.gl.uniformBlockBinding(this.program,l,a),this.uniformBlocks[n]=a}}uniform(t,i){return this.uniforms[t]&&this.uniforms[t].set(i),this}bind(){return this.appState.program!==this&&(this.gl.useProgram(this.program),this.appState.program=this),this}}class at{constructor(t,i){this.gl=t,this.query=null,this.target=i,this.active=!1,this.result=null,this.restore()}restore(){return this.query=this.gl.createQuery(),this.active=!1,this.result=null,this}begin(){return this.active||(this.gl.beginQuery(this.target,this.query),this.result=null),this}end(){return this.active||(this.gl.endQuery(this.target),this.active=!0),this}ready(){return this.active&&this.gl.getQueryParameter(this.query,e.QUERY_RESULT_AVAILABLE)?(this.active=!1,this.result=Number(this.gl.getQueryParameter(this.query,e.QUERY_RESULT)),!0):!1}delete(){return this.query&&(this.gl.deleteQuery(this.query),this.query=null),this}}class Bt{constructor(t){this.gl=t,this.cpuTimer=window.performance||window.Date,this.gpuTimerQuery=null,this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this.restore()}restore(){return c.GPU_TIMER&&(this.gpuTimerQuery?this.gpuTimerQuery.restore():this.gpuTimerQuery=new at(this.gl,e.TIME_ELAPSED_EXT)),this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this}start(){return c.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.begin(),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now(),this}end(){return c.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.end(),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime,this}ready(){if(c.GPU_TIMER){if(!this.gpuTimerQuery.active)return!1;var t=this.gpuTimerQuery.ready(),i=this.gl.getParameter(e.GPU_DISJOINT_EXT);return t&&!i?(this.gpuTime=this.gpuTimerQuery.result/1e6,!0):!1}else return!!this.cpuStartTime}delete(){return this.gpuTimerQuery&&(this.gpuTimerQuery.delete(),this.gpuTimerQuery=null),this}}class Dt{constructor(t,i){this.gl=t,this.appState=i,this.transformFeedback=null,this.restore()}restore(){return this.appState.transformFeedback===this&&(this.appState.transformFeedback=null),this.transformFeedback=this.gl.createTransformFeedback(),this}feedbackBuffer(t,i){return this.gl.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,t,i.buffer),this.gl.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,t,null),this}delete(){return this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null,this.appState.transformFeedback===this&&(this.gl.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null)),this}bind(){return this.appState.transformFeedback!==this&&(this.gl.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.transformFeedback),this.appState.transformFeedback=this),this}}class Ft{constructor(t,i,r,s=t.DYNAMIC_DRAW){this.gl=t,this.buffer=null,this.dataViews={},this.offsets=new Array(r.length),this.sizes=new Array(r.length),this.types=new Array(r.length),this.size=0,this.usage=s,this.appState=i,this.currentBase=-1;for(let n=0,l=r.length;n<l;++n){let a=r[n];switch(a){case e.FLOAT:case e.INT:case e.UNSIGNED_INT:case e.BOOL:this.offsets[n]=this.size,this.sizes[n]=1,a===e.INT?this.types[n]=e.INT:a===e.UNSIGNED_INT?this.types[n]=e.UNSIGNED_INT:this.types[n]=e.FLOAT,this.size++;break;case e.FLOAT_VEC2:case e.INT_VEC2:case e.UNSIGNED_INT_VEC2:case e.BOOL_VEC2:this.size+=this.size%2,this.offsets[n]=this.size,this.sizes[n]=2,a===e.INT_VEC2?this.types[n]=e.INT:a===e.UNSIGNED_INT_VEC2?this.types[n]=e.UNSIGNED_INT:this.types[n]=e.FLOAT,this.size+=2;break;case e.FLOAT_VEC3:case e.INT_VEC3:case e.UNSIGNED_INT_VEC3:case e.BOOL_VEC3:case e.FLOAT_VEC4:case e.INT_VEC4:case e.UNSIGNED_INT_VEC4:case e.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[n]=this.size,this.sizes[n]=4,a===e.INT_VEC4||a===e.INT_VEC3?this.types[n]=e.INT:a===e.UNSIGNED_INT_VEC4||a===e.UNSIGNED_INT_VEC3?this.types[n]=e.UNSIGNED_INT:this.types[n]=e.FLOAT,this.size+=4;break;case e.FLOAT_MAT2:case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[n]=this.size,this.sizes[n]=8,this.types[n]=e.FLOAT,this.size+=8;break;case e.FLOAT_MAT3:case e.FLOAT_MAT3x2:case e.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[n]=this.size,this.sizes[n]=12,this.types[n]=e.FLOAT,this.size+=12;break;case e.FLOAT_MAT4:case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[n]=this.size,this.sizes[n]=16,this.types[n]=e.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[e.FLOAT]=this.data,this.dataViews[e.INT]=new Int32Array(this.data.buffer),this.dataViews[e.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.dirtyStart=this.size,this.dirtyEnd=0,this.restore()}restore(){return this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(e.UNIFORM_BUFFER,this.buffer),this.gl.bufferData(e.UNIFORM_BUFFER,this.size*4,this.usage),this.gl.bindBuffer(e.UNIFORM_BUFFER,null),this}set(t,i){let r=this.dataViews[this.types[t]],s=this.offsets[t],n=this.sizes[t];return this.sizes[t]===1?r[s]=i:r.set(i,s),s<this.dirtyStart&&(this.dirtyStart=s),this.dirtyEnd<s+n&&(this.dirtyEnd=s+n),this}update(){if(this.dirtyStart>=this.dirtyEnd)return this;let t=this.data.subarray(this.dirtyStart,this.dirtyEnd),i=this.dirtyStart*4;return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,i,t),this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,null),this.dirtyStart=this.size,this.dirtyEnd=0,this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null,this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.currentBase=-1),this}bind(t){let i=this.appState.uniformBuffers[t];return i!==this&&(i&&(i.currentBase=-1),this.currentBase!==-1&&(this.appState.uniformBuffers[this.currentBase]=null),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,t,this.buffer),this.appState.uniformBuffers[t]=this,this.currentBase=t),this}}class Mt{constructor(t,i){this.gl=t,this.appState=i,this.vertexArray=null,this.indexType=null,this.indexed=!1,this.numElements=0,this.numInstances=1,this.offsets=0,this.numDraws=1}restore(){return this.appState.vertexArray===this&&(this.appState.vertexArray=null),this.vertexArray!==null&&(this.vertexArray=this.gl.createVertexArray()),this}vertexAttributeBuffer(t,i,r=F){return this.attributeBuffer(t,i,r,!1),this}instanceAttributeBuffer(t,i,r=F){return this.attributeBuffer(t,i,r,!0),this}indexBuffer(t){return this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.buffer),this.numElements=t.numItems*3,this.indexType=t.type,this.indexed=!0,this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null,this.appState.vertexArray===this&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null)),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(t,i,r={},s){this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(e.ARRAY_BUFFER,i.buffer);let{type:n=i.type,size:l=i.itemSize,stride:a=0,offset:o=0,normalized:E=!1,integer:_=!!(i.integer&&!E)}=r,u=i.numColumns;a===0&&(a=u*l*w[n]);let T=Math.ceil((i.byteLength-o)/a);for(let f=0;f<u;++f)_?this.gl.vertexAttribIPointer(t+f,l,n,a,o+f*l*w[n]):this.gl.vertexAttribPointer(t+f,l,n,E,a,o+f*l*w[n]),s&&this.gl.vertexAttribDivisor(t+f,1),this.gl.enableVertexAttribArray(t+f);return this.numDraws===1&&(s?this.numInstances=T:this.indexed||(this.numElements=T)),this.gl.bindBuffer(e.ARRAY_BUFFER,null),this}}const Ot={[e.BYTE]:!0,[e.UNSIGNED_BYTE]:!0,[e.SHORT]:!0,[e.UNSIGNED_SHORT]:!0,[e.INT]:!0,[e.UNSIGNED_INT]:!0};class b{constructor(t,i,r,s,n,l=t.STATIC_DRAW,a){let o;switch(r){case e.FLOAT_MAT4:case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:o=4;break;case e.FLOAT_MAT3:case e.FLOAT_MAT3x2:case e.FLOAT_MAT3x4:o=3;break;case e.FLOAT_MAT2:case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:o=2;break;default:o=1}switch(r){case e.FLOAT_MAT4:case e.FLOAT_MAT3x4:case e.FLOAT_MAT2x4:s=4,r=e.FLOAT;break;case e.FLOAT_MAT3:case e.FLOAT_MAT4x3:case e.FLOAT_MAT2x3:s=3,r=e.FLOAT;break;case e.FLOAT_MAT2:case e.FLOAT_MAT3x2:case e.FLOAT_MAT4x2:s=2,r=e.FLOAT;break}let E,_;typeof n=="number"?(E=n,r&&(n*=w[r]),_=n):(E=n.length,_=n.byteLength),this.gl=t,this.buffer=null,this.appState=i,this.type=r,this.itemSize=s,this.numItems=r?E/(s*o):_/s,this.numColumns=o,this.byteLength=_,this.usage=l,this.indexArray=!!a,this.integer=!!Ot[this.type],this.binding=this.indexArray?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER,this.restore(n)}restore(t){return t||(t=this.byteLength),this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferData(this.binding,t,this.usage),this.gl.bindBuffer(this.binding,null),this}data(t,i=0){return this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,i,t),this.gl.bindBuffer(this.binding,null),this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this}}class Lt{constructor(t){this.gl=t,this.canvas=t.canvas,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(c.MAX_TEXTURE_UNITS),uniformBuffers:new Array(c.MAX_UNIFORM_BUFFERS),freeUniformBufferBases:[],framebuffers:{},drawFramebufferBinding:e.DRAW_FRAMEBUFFER,readFramebufferBinding:e.READ_FRAMEBUFFER,extensions:{}},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.cpuTime=0,this.gpuTime=0,this.viewport(0,0,this.width,this.height),this.contextLostExt=null,this.contextLostListener=null,this.contextRestoredListener=null,this.contextRestoredHandler=null,this.initExtensions()}loseContext(){return this.contextLostExt&&this.contextLostExt.loseContext(),this}restoreContext(){return this.contextLostExt&&this.contextLostExt.restoreContext(),this}onContextRestored(t){return this.contextRestoredHandler=t,this.initContextListeners(),this}enable(t){return this.gl.enable(t),this}disable(t){return this.gl.disable(t),this}colorMask(t,i,r,s){return this.gl.colorMask(t,i,r,s),this}clearColor(t,i,r,s){return this.gl.clearColor(t,i,r,s),this}clearMask(t){return this.clearBits=t,this}clear(){return this.gl.clear(this.clearBits),this}drawFramebuffer(t){return t.bindForDraw(),this}readFramebuffer(t){return t.bindForRead(),this}defaultDrawFramebuffer(){let t=this.state.drawFramebufferBinding;return this.state.framebuffers[t]!==null&&(this.gl.bindFramebuffer(t,null),this.state.framebuffers[t]=null),this}defaultReadFramebuffer(){let t=this.state.readFramebufferBinding;return this.state.framebuffers[t]!==null&&(this.gl.bindFramebuffer(t,null),this.state.framebuffers[t]=null),this}blitFramebuffer(t,i=F){let r=this.state.readFramebufferBinding,s=this.state.drawFramebufferBinding,n=this.state.framebuffers[r],l=this.state.framebuffers[s],a=n?n.width:this.width,o=n?n.height:this.height,E=l?l.width:this.width,_=l?l.height:this.height,{srcStartX:u=0,srcStartY:T=0,srcEndX:f=a,srcEndY:x=o,dstStartX:d=0,dstStartY:m=0,dstEndX:N=E,dstEndY:C=_,filter:B=e.NEAREST}=i;return this.gl.blitFramebuffer(u,T,f,x,d,m,N,C,t,B),this}depthRange(t,i){return this.gl.depthRange(t,i),this}depthMask(t){return this.gl.depthMask(t),this}depthFunc(t){return this.gl.depthFunc(t),this}blendFunc(t,i){return this.gl.blendFunc(t,i),this}blendFuncSeparate(t,i,r,s){return this.gl.blendFuncSeparate(t,i,r,s),this}blendEquation(t){return this.gl.blendEquation(t),this}stencilMask(t){return this.gl.stencilMask(t),this}stencilMaskSeparate(t,i){return this.gl.stencilMaskSeparate(t,i),this}stencilFunc(t,i,r){return this.gl.stencilFunc(t,i,r),this}stencilFuncSeparate(t,i,r,s){return this.gl.stencilFuncSeparate(t,i,r,s),this}stencilOp(t,i,r){return this.gl.stencilOp(t,i,r),this}stencilOpSeparate(t,i,r,s){return this.gl.stencilOpSeparate(t,i,r,s),this}scissor(t,i,r,s){return this.gl.scissor(t,i,r,s),this}polygonOffset(t,i){return this.gl.polygonOffset(t,i),this}readPixel(t,i,r,s=F){let{format:n=e.RGBA,type:l=e.UNSIGNED_BYTE}=s;return this.gl.readPixels(t,i,1,1,n,l,r),this}viewport(t,i,r,s){return(this.viewportWidth!==r||this.viewportHeight!==s||this.viewportX!==t||this.viewportY!==i)&&(this.viewportX=t,this.viewportY=i,this.viewportWidth=r,this.viewportHeight=s,this.gl.viewport(t,i,this.viewportWidth,this.viewportHeight)),this}defaultViewport(){return this.viewport(0,0,this.width,this.height),this}resize(t,i){return this.canvas.width=t,this.canvas.height=i,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewport(0,0,this.width,this.height),this}createProgram(t,i,r={}){let{transformFeedbackVaryings:s,attributeLocations:n,transformFeedbackMode:l}=r;return new j(this.gl,this.state,t,i,s,n,l).link().checkLinkage()}createPrograms(...t){return new Promise((i,r)=>{let s=t.length,n=new Array(s),l=new Array(s),a=s;for(let E=0;E<s;++E){let _=t[E],u=_[0],T=_[1],f=_[2]||{},{transformFeedbackVaryings:x,attributeLocations:d,transformFeedbackMode:m}=f;n[E]=new j(this.gl,this.state,u,T,x,d,m),l[E]=n[E]}for(let E=0;E<s;++E)n[E].link();let o=()=>{let E=0;for(let _=0;_<a;++_)if(l[_].checkCompletion())if(l[_].checkLinkage(),l[_].linked)++E;else{r(new Error("Program linkage failed"));return}else l[_-E]=l[_];a-=E,a===0?i(n):requestAnimationFrame(o)};o()})}restorePrograms(...t){return new Promise((i,r)=>{let s=t.length,n=t.slice(),l=s;for(let o=0;o<s;++o)t[o].initialize();for(let o=0;o<s;++o)t[o].link();for(let o=0;o<s;++o)t[o].checkCompletion();let a=()=>{let o=0;for(let E=0;E<l;++E)if(n[E].checkCompletion())if(n[E].checkLinkage(),n[E].linked)++o;else{r(new Error("Program linkage failed"));return}else n[E-o]=n[E];l-=o,l===0?i():requestAnimationFrame(a)};a()})}createShader(t,i){return new M(this.gl,this.state,t,i)}createVertexArray(){return new Mt(this.gl,this.state)}createTransformFeedback(){return new Dt(this.gl,this.state)}createVertexBuffer(t,i,r,s){return new b(this.gl,this.state,t,i,r,s)}createMatrixBuffer(t,i,r){return new b(this.gl,this.state,t,0,i,r)}createInterleavedBuffer(t,i,r){return new b(this.gl,this.state,null,t,i,r)}createIndexBuffer(t,i,r,s){return ArrayBuffer.isView(i)&&(s=r,r=i,i=3),new b(this.gl,this.state,t,i,r,s,!0)}createUniformBuffer(t,i){return new Ft(this.gl,this.state,t,i)}createTexture2D(t,i,r,s){return typeof t=="number"?(s=r,r=i,i=t,t=null):r===void 0&&(s=i,i=t.width,r=t.height),new L(this.gl,this.state,this.gl.TEXTURE_2D,t,i,r,void 0,!1,s)}createTextureArray(t,i,r,s,n){return typeof t=="number"&&(n=s,s=r,r=i,i=t,t=null),new L(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,t,i,r,s,!0,n)}createTexture3D(t,i,r,s,n){return typeof t=="number"&&(n=s,s=r,r=i,i=t,t=null),new L(this.gl,this.state,this.gl.TEXTURE_3D,t,i,r,s,!0,n)}createCubemap(t){return new Nt(this.gl,this.state,t)}createRenderbuffer(t,i,r,s=0){return new k(this.gl,t,i,r,s)}createFramebuffer(){return new pt(this.gl,this.state)}createQuery(t){return new at(this.gl,t)}createTimer(){return new Bt(this.gl)}createDrawCall(t,i,r){return new Ct(this.gl,this.state,t,i,r)}initExtensions(){this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("WEBGL_compressed_texture_s3tc"),this.gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.gl.getExtension("WEBGL_compressed_texture_etc"),this.gl.getExtension("WEBGL_compressed_texture_astc"),this.gl.getExtension("WEBGL_compressed_texture_pvrtc"),this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.gl.getExtension("EXT_disjoint_timer_query"),this.gl.getExtension("EXT_texture_filter_anisotropic"),this.state.extensions.debugShaders=this.gl.getExtension("WEBGL_debug_shaders"),this.contextLostExt=this.gl.getExtension("WEBGL_lose_context"),this.gl.getExtension("KHR_parallel_shader_compile"),this.state.extensions.multiDrawInstanced=this.gl.getExtension("WEBGL_multi_draw_instanced")}initContextListeners(){this.contextRestoredHandler?(this.contextLostListener=t=>{t.preventDefault()},this.contextRestoredListener=()=>{this.initExtensions(),this.contextRestoredHandler()},this.canvas.addEventListener("webglcontextlost",this.contextLostListener),this.canvas.addEventListener("webglcontextrestored",this.contextRestoredListener)):(this.canvas.removeEventListener("webglcontextlost",this.contextLostListener),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredListener),this.contextLostListener=null,this.contextRestoredListener=null)}depthTest(){return console.warn("App.depthTest is deprecated. Use App.enable(PicoGL.DEPTH_TEST) instead."),this.enable(e.DEPTH_TEST),this}noDepthTest(){return console.warn("App.noDepthTest is deprecated. Use App.disable(PicoGL.DEPTH_TEST) instead."),this.disable(e.DEPTH_TEST),this}blend(){return console.warn("App.blend is deprecated. Use App.enable(PicoGL.BLEND) instead."),this.enable(e.BLEND),this}noBlend(){return console.warn("App.noBlend is deprecated. Use App.disable(PicoGL.BLEND) instead."),this.disable(e.BLEND),this}stencilTest(){return console.warn("App.stencilTest is deprecated. Use App.enable(PicoGL.STENCIL_TEST) instead."),this.enable(e.STENCIL_TEST),this}noStencilTest(){return console.warn("App.noStencilTest is deprecated. Use App.disable(PicoGL.STENCIL_TEST) instead."),this.disable(e.STENCIL_TEST),this}scissorTest(){return console.warn("App.scissorTest is deprecated. Use App.enable(PicoGL.SCISSOR_TEST) instead."),this.enable(e.SCISSOR_TEST),this}noScissorTest(){return console.warn("App.noScissorTest is deprecated. Use App.disable(PicoGL.SCISSOR_TEST) instead."),this.disable(e.SCISSOR_TEST),this}rasterize(){return console.warn("App.noRasterize is deprecated. Use App.disable(PicoGL.RASTERIZER_DISCARD) instead."),this.disable(e.RASTERIZER_DISCARD),this}noRasterize(){return console.warn("App.rasterize is deprecated. Use App.enable(PicoGL.RASTERIZER_DISCARD) instead."),this.enable(e.RASTERIZER_DISCARD),this}cullBackfaces(){return console.warn("App.cullBackfaces is deprecated. Use App.enable(PicoGL.CULL_FACE) instead."),this.enable(e.CULL_FACE),this}drawBackfaces(){return console.warn("App.drawBackfaces is deprecated. Use App.disable(PicoGL.CULL_FACE) instead."),this.disable(e.CULL_FACE),this}}let q=!1;const g=Object.assign({version:"0.17.9",WEBGL_INFO:c,createApp(h,t){return h.tagName==="CANVAS"&&(h=h.getContext("webgl2",t)),q||(c.MAX_TEXTURE_UNITS=h.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),c.MAX_UNIFORM_BUFFERS=h.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),c.MAX_UNIFORMS=Math.min(h.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),h.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS)),c.SAMPLES=h.getParameter(e.SAMPLES),c.VENDOR="(Unknown)",c.RENDERER="(Unknown)",c.FLOAT_RENDER_TARGETS=!!h.getExtension("EXT_color_buffer_float"),c.LINEAR_FLOAT_TEXTURES=!!h.getExtension("OES_texture_float_linear"),c.S3TC_TEXTURES=!!h.getExtension("WEBGL_compressed_texture_s3tc"),c.S3TC_SRGB_TEXTURES=!!h.getExtension("WEBGL_compressed_texture_s3tc_srgb"),c.ETC_TEXTURES=!!h.getExtension("WEBGL_compressed_texture_etc"),c.ASTC_TEXTURES=!!h.getExtension("WEBGL_compressed_texture_astc"),c.PVRTC_TEXTURES=!!h.getExtension("WEBGL_compressed_texture_pvrtc"),c.LOSE_CONTEXT=!!h.getExtension("WEBGL_lose_context"),c.DEBUG_SHADERS=!!h.getExtension("WEBGL_debug_shaders"),c.GPU_TIMER=!!(h.getExtension("EXT_disjoint_timer_query_webgl2")||h.getExtension("EXT_disjoint_timer_query")),c.TEXTURE_ANISOTROPY=!!h.getExtension("EXT_texture_filter_anisotropic"),c.MAX_TEXTURE_ANISOTROPY=c.TEXTURE_ANISOTROPY?h.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,c.DEBUG_RENDERER_INFO=!!h.getExtension("WEBGL_debug_renderer_info"),c.DEBUG_RENDERER_INFO&&(c.VENDOR=h.getParameter(e.UNMASKED_VENDOR_WEBGL),c.RENDERER=h.getParameter(e.UNMASKED_RENDERER_WEBGL)),c.PARALLEL_SHADER_COMPILE=!!h.getExtension("KHR_parallel_shader_compile"),c.MULTI_DRAW_INSTANCED=!!h.getExtension("WEBGL_multi_draw_instanced"),q=!0),new Lt(h)}},e);function ht(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}function Pt(h){if(h.__esModule)return h;var t=h.default;if(typeof t=="function"){var i=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(h).forEach(function(r){var s=Object.getOwnPropertyDescriptor(h,r);Object.defineProperty(i,r,s.get?s:{enumerable:!0,get:function(){return h[r]}})}),i}var lt={},K={},X={};X.regexRule=function(h,t,{lineBreaks:i=!1,stateCondition:r=o=>!0,value:s=(o,E)=>o[0],last:n=(o,E)=>!1,condition:l=(o,E)=>!0,nextState:a=(o,E)=>E}={}){if(!t.sticky&&!t.global)throw new TypeError("Either sticky (/y, recommended) or global (/g) has to be enabled for the regular expresion.");return{type:h,lineBreaks:i,match(o,E,_){if(!r(_))return null;t.lastIndex=E;let u=t.exec(o);return u==null||u.index!==E||!l(u,_)?null:{length:u[0].length,value:s(u,_),last:n(u,_),state:a(u,_)}}}};X.tokenizerRule=function(h,t,{lineBreaks:i=!1,stateCondition:r=o=>!0,value:s=(o,E)=>o,last:n=(o,E)=>!1,condition:l=(o,E)=>!0,nextState:a=(o,E)=>E}={}){return{type:h,lineBreaks:i,match(o,E,_){if(!r(_))return null;let u=t(o);u.col=this.col,u.row=this.row,u.pos=E;let T=[...u];return l(T,_)?{length:u.pos-E,value:s(T,_),last:n(T,_),state:a(T,_)}:null}}};X.createTokenizer=function({rules:h,strategy:t="first",state:i={}}){if(!["first","longest"].includes(t))throw new TypeError("Only 'first' and 'longest' are allowed as values for the strategy option.");return function(s){return{state:i,row:0,col:0,pos:0,done:!1,[Symbol.iterator](){return this},next(){for(;!this.done&&this.pos<s.length;){let n,l,a,o=!1;for(let u of h){if(a=u.match.call(this,s,this.pos,this.state),a==null)continue;let T=a.value;if(T===void 0&&(T=l=s.substr(this.pos,a.length)),(n==null||n.length<a.length)&&(n={type:u.type,value:T,row:this.row,col:this.col,pos:this.pos,length:a.length},o=!!u.lineBreaks),t==="first")break}n==null&&(n={type:null,value:s[this.pos],row:this.row,col:this.col,pos:this.pos,length:1},o=!0);let E=0,_=-1;if(o&&(l==null&&(l=s.substr(this.pos,n.length)),E=Array.from(l).filter((u,T)=>u===`
`?(_=T,!0):!1).length,this.row+=E),E>0?this.col=n.length-_-1:this.col+=n.length,this.pos+=n.length,a!=null&&a.state!=null&&(this.state=a.state,this.done=!!a.last),n.type==null||n.type[0]!=="_")return{value:n,done:!1}}return this.done=!0,{done:!0}}}}};var Ut=(()=>{try{let h=require("iconv-lite");if(h==null)throw new Error;return h}catch{return{encodingExists:()=>!0,decode:t=>t.toString(),encode:(t,i)=>t}}})(),Gt=(()=>{try{let h=require("jschardet");if(h==null)throw new Error;return h}catch{return{detect:()=>({encoding:"UTF-8"})}}})(),U={};(function(h){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";h.escapeString=function(i){return i.toString().replace(/\\/g,"\\\\").replace(/\]/g,"\\]")},h.unescapeString=function(i){let r=[],s=!1;i=i.replace(/\r/g,"");for(let n=0;n<i.length;n++)s?(i[n]!==`
`&&r.push(i[n]),s=!1):i[n]!=="\\"?r.push(i[n]):i[n]==="\\"&&(s=!0);return r.join("")},h.parseDates=function(i){if(!i.match(/^(\d{4}(-\d{1,2}(-\d{1,2})?)?(\s*,\s*(\d{4}|(\d{4}-)?\d{1,2}(-\d{1,2})?))*)?$/))return null;if(i.trim()==="")return[];let r=i.split(",").map(s=>s.trim().split("-"));for(let s=1;s<r.length;s++){let n=r[s],l=r[s-1];n[0].length!==4&&(n.length===1&&l.length===3&&n.unshift(l[1]),n.unshift(l[0]))}return r.map(s=>s.map(n=>+n))},h.stringifyDates=function(i){if(i.length===0)return"";let r=[i[0].slice()];for(let s=1;s<i.length;s++){let n=i[s],l=i[s-1],a=0;for(let o=0;o<n.length&&(n[o]===l[o]&&a===o);o++)a++;r.push(n.slice(a))}return r.map(s=>s.map(n=>n>9?""+n:"0"+n).join("-")).join(",")},h.parseVertex=function(i){return i.length!==2?[-1,-1]:i.split("").map(r=>t.indexOf(r))},h.stringifyVertex=function([i,r]){return Math.min(i,r)<0||Math.max(i,r)>=t.length?"":t[i]+t[r]},h.parseCompressedVertices=function(i){let r=i.indexOf(":");if(r<0)return[h.parseVertex(i)];let[s,n]=h.parseVertex(i.slice(0,r)),[l,a]=h.parseVertex(i.slice(r+1)),o=[];for(let E=Math.min(s,l);E<=Math.max(s,l);E++)for(let _=Math.min(n,a);_<=Math.max(n,a);_++)o.push([E,_]);return o}})(U);(function(h){const{createTokenizer:t,regexRule:i}=X,r=Ut,s=Gt,{unescapeString:n}=U,l=t({rules:[i("_whitespace",/\s+/y,{lineBreaks:!0}),i("parenthesis",/(\(|\))/y),i("semicolon",/;/y),i("prop_ident",/[A-Za-z]+/y),i("c_value_type",/\[([^\\\]]|\\[^])*\]/y,{lineBreaks:!0}),{type:"invalid",match:(a,o)=>({length:1})}]});h.tokenizeIter=function*(a){for(let o of l(a))o.progress=o.pos/(a.length-1),delete o.length,yield o},h.tokenizeBufferIter=function*(a,{encoding:o=null}={}){if(o!=null){yield*h.tokenizeIter(r.decode(a,o));return}let E=s.detect(a.slice(0,300)).encoding,_=r.decode(a,E),u=h.tokenizeIter(_),T=[];for(;;){let f=u.next();if(f.done)break;let{type:x,value:d}=f.value,m=T[T.length-1];if(T.push(f.value),x==="c_value_type"&&m!=null&&m.type==="prop_ident"&&m.value==="CA"){o=n(d.slice(1,-1));break}}o!=null&&o!=E&&r.encodingExists(o)?yield*h.tokenizeIter(r.decode(a,o)):(yield*T,yield*u)},h.tokenize=a=>[...h.tokenizeIter(a)],h.tokenizeBuffer=(a,o)=>[...h.tokenizeBufferIter(a,o)]})(K);var ot={};const bt={},yt=Object.freeze(Object.defineProperty({__proto__:null,default:bt},Symbol.toStringTag,{value:"Module"})),wt=Pt(yt);class vt{constructor(t){this.iterator=t[Symbol.iterator](),this.peekedItem=null,this.peeked=!1}next(){let t=this.peeked?this.peekedItem:this.iterator.next();return this.peekedItem=null,this.peeked=!1,t}peek(){return this.peeked||(this.peekedItem=this.iterator.next(),this.peeked=!0),this.peekedItem}}var Ht=vt;(function(h){const t=wt,i=Ht,{tokenizeIter:r,tokenizeBufferIter:s}=K,{unescapeString:n}=U;function l(a,o,E){let{getId:_,dictionary:u,onProgress:T,onNodeCreated:f}=E,x=null,d,m;for(;!a.peek().done;){let{type:N,value:C,row:B,col:D}=a.peek().value;if(N==="parenthesis"&&C==="(")break;if(N==="parenthesis"&&C===")")return d!=null&&f({node:d}),x;if(N==="semicolon"||d==null){let p=d;d={id:_(),data:{},parentId:p==null?o:p.id,children:[]},u!=null&&(u[d.id]=d),p!=null?(f({node:p}),p.children.push(d)):x=d}if(N!=="semicolon")if(N==="prop_ident"){if(d!=null){let p=C===C.toUpperCase()?C:C.split("").filter(G=>G.toUpperCase()===G).join("");p!==""?(p in d.data||(d.data[p]=[]),m=d.data[p]):m=null}}else if(N==="c_value_type")m!=null&&m.push(n(C.slice(1,-1)));else throw N==="invalid"?new Error(`Unexpected token at ${B+1}:${D+1}`):new Error(`Unexpected token type '${N}' at ${B+1}:${D+1}`);a.next()}for(d==null?x=d={id:null,data:{},parentId:null,children:[]}:f({node:d});!a.peek().done;){let{type:N,value:C,progress:B}=a.peek().value;if(N==="parenthesis"&&C==="("){a.next();let D=l(a,d.id,E);D!=null&&d.children.push(D)}else if(N==="parenthesis"&&C===")"){T({progress:B});break}a.next()}return x}h.parseTokens=function(a,{getId:o=(T=>()=>T++)(0),dictionary:E=null,onProgress:_=()=>{},onNodeCreated:u=()=>{}}={}){let T=l(new i(a),null,{getId:o,dictionary:E,onProgress:_,onNodeCreated:u});return T.id==null?T.children:[T]},h.parse=function(a,o={}){return h.parseTokens(r(a),o)},h.parseBuffer=function(a,o={}){return h.parseTokens(s(a,{encoding:o.encoding}),o)},h.parseFile=function(a,o={}){return h.parseBuffer(t.readFileSync(a),o)}})(ot);var Et={};(function(h){const{escapeString:t}=U;h.stringify=function(i,{linebreak:r=`
`,indent:s="  ",level:n=0}={}){if(Array.isArray(i))return h.stringify({children:i},{linebreak:r,level:n});let l=[],a=r!==""?s.repeat(n):"";if(i.data!=null){l.push(a,";");for(let o in i.data)o.toUpperCase()===o&&l.push(o,"[",i.data[o].map(t).join("]["),"]");l.push(r)}if(i.children.length>1||i.children.length>0&&n===0){l.push(a);for(let o of i.children)l.push("(",r,h.stringify(o,{linebreak:r,level:n+1}),a,")");l.push(r)}else i.children.length===1&&l.push(h.stringify(i.children[0],{linebreak:r,level:n}));return l.join("")}})(Et);(function(h){const{tokenizeIter:t,tokenizeBufferIter:i,tokenize:r,tokenizeBuffer:s}=K,{parse:n,parseTokens:l,parseBuffer:a,parseFile:o}=ot,{stringify:E}=Et;Object.assign(h,{tokenizeIter:t,tokenizeBufferIter:i,tokenize:r,tokenizeBuffer:s,parse:n,parseTokens:l,parseBuffer:a,parseFile:o,stringify:E},U)})(lt);let Xt=class{constructor(t){this.base=t,this.root=t.root,this._passOnNodeCache=!0,this._nodeCache={},this._idAliases=t._idAliases,this._heightCache=t._heightCache,this._structureHashCache=t._structureHashCache}get(t){if(t==null)return null;if(t in this._idAliases)return this.get(this._idAliases[t]);if(t in this._nodeCache)return this._nodeCache[t];let i=this.base.get(t);if(i==null)return this._nodeCache[t]=null,null;let r={...i,data:{...i.data},children:[...i.children]};if(i.parentId!=null){let s=this.get(i.parentId),n=s.children.findIndex(l=>l.id===t);n>=0&&(s.children[n]=r)}return this._nodeCache[t]=r,this.root.id===t&&(this.root=r),r}_getLevel(t){let i=-1,r=this.get(t);for(;r!=null;)i++,r=this.get(r.parentId);return i}appendNode(t,i,r={}){let s=this.base.getId();if(!this.UNSAFE_appendNodeWithId(t,s,i,r))return null;if(!(s in this._idAliases))return s;let a=this._idAliases[s];return delete this._idAliases[s],a}UNSAFE_appendNodeWithId(t,i,r,{disableMerging:s}={}){let n=this.get(t);if(n==null)return!1;let[l,a]=(()=>{if(!s)for(let o of n.children){let E=this.base.merger(o,r);if(E!=null)return[o.id,E]}return[null,null]})();if(l!=null){let o=this.get(l);o.data=a,i!==l&&(this._idAliases[i]=l)}else{let o={id:i,data:r,parentId:t,children:[]};n.children.push(o),this._nodeCache[i]=o,this._structureHashCache=null,this._heightCache!=null&&this._getLevel(t)===this._heightCache-1&&this._heightCache++}return!0}removeNode(t){let i=this.get(t);if(i==null)return!1;let r=i.parentId;if(r==null)throw new Error("Cannot remove root node");let s=this.get(r);if(s==null)return!1;let n=s.children.findIndex(l=>l.id===t);if(n>=0)s.children.splice(n,1);else return!1;return this._nodeCache[t]=null,this._structureHashCache=null,this._heightCache=null,!0}shiftNode(t,i){if(!["left","right","main"].includes(i))throw new Error("Invalid value for direction, only 'left', 'right', or 'main' allowed");let r=this.get(t);if(r==null)return null;let{parentId:s}=r,n=this.get(s);if(n==null)return null;let l=n.children.findIndex(o=>o.id===t);if(l<0)return null;let a={left:Math.max(l-1,0),right:Math.min(l+1,n.children.length),main:0}[i];if(l!==a){let[o]=n.children.splice(l,1);n.children.splice(a,0,o)}return this._structureHashCache=null,a}makeRoot(t){if(t===this.root.id)return!0;let i=this.get(t);return i==null?!1:(i.parentId=null,this.root=i,this._passOnNodeCache=!1,this._heightCache=null,this._structureHashCache=null,!0)}addToProperty(t,i,r){let s=this.get(t);return s==null?!1:(s.data[i]==null?s.data[i]=[r]:s.data[i].includes(r)||(s.data[i]=[...s.data[i],r]),!0)}removeFromProperty(t,i,r){let s=this.get(t);return s==null||s.data[i]==null?!1:(s.data[i]=s.data[i].filter(n=>n!==r),s.data[i].length===0&&delete s.data[i],!0)}updateProperty(t,i,r){let s=this.get(t);return s==null?!1:(r==null||r.length===0?delete s.data[i]:s.data[i]=r,!0)}removeProperty(t,i){return this.updateProperty(t,i,null)}};var kt=Xt,_t={};_t.new=function(){let h=5381;return t=>{for(let i=0;i<t.length;i++)h=h*33^t.charCodeAt(i);return h}};const Vt=kt,J=_t;let Yt=class ut{constructor({getId:t=null,merger:i=null,root:r=null}={}){this.getId=t||((s=0)=>()=>s++)(),this.merger=i||(()=>null),r={id:this.getId(),data:{},parentId:null,children:[],...r||{}},this.root=r,this._nodeCache={},this._idAliases={},this._heightCache=null,this._hashCache=null,this._structureHashCache=null}get(t){let i=null;if(t==null)return i;if(t in this._idAliases)return this.get(this._idAliases[t]);if(t in this._nodeCache)i=this._nodeCache[t];else{let r=s=>{if(this._nodeCache[s.id]=s,s.id===t)return s;for(let n of s.children){let l=r(n);if(l!=null)return l}return null};i=r(this.root)}if(i==null)return this._nodeCache[t]=null,null;for(let r of i.children)this._nodeCache[r.id]=r;return i}*getSequence(t){let i=this.get(t);if(i!=null)for(yield i;i.children.length===1;){i=i.children[0],this._nodeCache[i.id]=i;for(let r of i.children)this._nodeCache[r.id]=r;yield i}}mutate(t){let i=new Vt(this);if(t(i),i.root===this.root)return this;let r=new ut({getId:this.getId,merger:this.merger,root:i.root});return i._passOnNodeCache&&(r._nodeCache=i._nodeCache),r._idAliases=i._idAliases,r._structureHashCache=i._structureHashCache,r._heightCache=i._heightCache,r}navigate(t,i,r){let s=this.get(t);if(s==null)return null;if(i===0)return s;if(i<0)return this.navigate(s.parentId,i+1);let n=r[s.id]!=null?r[s.id]:s.children.length>0?s.children[0].id:null;return n==null?null:this.navigate(n,i-1,r)}*listNodes(){function*t(i){yield i;for(let r of i.children)yield*t(r)}yield*t(this.root)}*listNodesHorizontally(t,i){if(Math.abs(i)!==1)throw new Error("Invalid value for step, only -1 or 1 allowed");let r=this.getLevel(t),s=[...this.getSection(r)],n=s.findIndex(l=>l.id===t);for(;s[n]!=null;){for(;0<=n&&n<s.length;)yield s[n],n+=i;r+=i,s=i>0?[].concat(...s.map(l=>l.children)):[...this.getSection(r)],n=i>0?0:s.length-1}}*listNodesVertically(t,i,r){if(Math.abs(i)!==1)throw new Error("Invalid value for step, only -1 or 1 allowed");let s=t,n=this.get(s);for(;n!=null;)yield n,n=this.navigate(n.id,i,r)}*listCurrentNodes(t){yield*this.listNodesVertically(this.root.id,1,t)}*listMainNodes(){yield*this.listCurrentNodes({})}getLevel(t){let i=-1;for(let r of this.listNodesVertically(t,-1,{}))i++;return i<0?null:i}*getSection(t){if(!(t<0)){if(t===0){yield this.root;return}for(let i of this.getSection(t-1))yield*i.children}}getCurrentHeight(t){let i=0,r=this.root;for(;r!=null;)i++,r=t[r.id]==null?r.children[0]:r.children.find(s=>s.id===t[r.id]);return i}getHeight(){if(this._heightCache==null){let t=i=>{let r=0;for(let s of i.children)r=Math.max(r,t(s));return r+1};this._heightCache=t(this.root)}return this._heightCache}getStructureHash(){if(this._structureHashCache==null){let t=J.new(),i=r=>(t("["+JSON.stringify(r.id)+","),r.children.forEach(i),t("]"));this._structureHashCache=i(this.root)}return(this._structureHashCache>>>0)+""}getHash(){if(this._hashCache==null){let t=J.new(),i=r=>(t("["+JSON.stringify(r.data)+","),r.children.forEach(i),t("]"));this._hashCache=i(this.root)}return(this._hashCache>>>0)+""}onCurrentLine(t,i){for(let r of this.listNodesVertically(t,-1,{})){let{parentId:s}=r;if(s!=null&&i[s]!==r.id&&(i[s]!=null||this.get(s).children[0]!==r))return!1}return!0}onMainLine(t){return this.onCurrentLine(t,{})}toJSON(){return this.root}};var Kt=Yt,Wt=Kt;const zt=ht(Wt),tt="ABCDEFGHJKLMNOPQRSTUVWXYZ";function y([h,t],[i,r]){return h===i&&t===r}let V=class Tt{constructor(t=[]){if(this.signMap=t,this.height=t.length,this.width=this.height===0?0:t[0].length,t.some(i=>i.length!==this.width))throw new Error("signMap is not well-formed");this._players=[1,-1],this._captures=[0,0],this._koInfo={sign:0,vertex:[-1,-1]}}get([t,i]){return this.signMap[i]!=null?this.signMap[i][t]:null}set([t,i],r){return this.has([t,i])&&(this.signMap[i][t]=r),this}has([t,i]){return 0<=t&&t<this.width&&0<=i&&i<this.height}clear(){return this.signMap=this.signMap.map(t=>t.map(i=>0)),this}makeMove(t,i,{preventSuicide:r=!1,preventOverwrite:s=!1,preventKo:n=!1}={}){let l=this.clone();if(t===0||!this.has(i))return l;if(s&&this.get(i))throw new Error("Overwrite prevented");if(t=t>0?1:-1,n&&this._koInfo.sign===t&&y(this._koInfo.vertex,i))throw new Error("Ko prevented");l.set(i,t);let a=l.getNeighbors(i),o=[],E=a.filter(T=>l.get(T)===-t&&!l.hasLiberties(T));for(let T of E)if(l.get(T)!==0)for(let f of l.getChain(T))l.set(f,0).setCaptures(t,x=>x+1),o.push(f);let _=l.getLiberties(i),u=o.length===1&&_.length===1&&y(_[0],o[0])&&a.every(T=>l.get(T)!==t);if(l._koInfo={sign:u?-t:0,vertex:u?o[0]:[-1,-1]},o.length===0&&_.length===0){if(r)throw new Error("Suicide prevented");for(let T of l.getChain(i))l.set(T,0).setCaptures(-t,f=>f+1)}return l}analyzeMove(t,i){let r=t===0||!this.has(i),s=!r&&!!this.get(i),n=this._koInfo.sign===t&&y(this._koInfo.vertex,i),l=this.get(i);this.set(i,t);let a=!r&&this.getNeighbors(i).some(E=>this.get(E)===-t&&!this.hasLiberties(E)),o=!r&&!a&&!this.hasLiberties(i);return this.set(i,l),{pass:r,overwrite:s,capturing:a,suicide:o,ko:n}}getCaptures(t){let i=this._players.indexOf(t);return i<0?null:this._captures[i]}setCaptures(t,i){let r=this._players.indexOf(t);return r>=0&&(this._captures[r]=typeof i=="function"?i(this._captures[r]):i),this}isSquare(){return this.width===this.height}isEmpty(){return this.signMap.every(t=>t.every(i=>!i))}isValid(){let t={};for(let i=0;i<this.width;i++)for(let r=0;r<this.height;r++){let s=[i,r];if(!(this.get(s)===0||s in t)){if(!this.hasLiberties(s))return!1;this.getChain(s).forEach(n=>t[n]=!0)}}return!0}getDistance([t,i],[r,s]){return Math.abs(r-t)+Math.abs(s-i)}getNeighbors(t){if(!this.has(t))return[];let[i,r]=t;return[[i-1,r],[i+1,r],[i,r-1],[i,r+1]].filter(s=>this.has(s))}getConnectedComponent(t,i,r=null){if(!this.has(t))return[];r||(r=[t]);for(let s of this.getNeighbors(t))i(s)&&(r.some(n=>y(n,s))||(r.push(s),this.getConnectedComponent(s,i,r)));return r}getChain(t){let i=this.get(t);return this.getConnectedComponent(t,r=>this.get(r)===i)}getRelatedChains(t){if(!this.has(t)||this.get(t)===0)return[];let i=[this.get(t),0];return this.getConnectedComponent(t,s=>i.includes(this.get(s))).filter(s=>this.get(s)===this.get(t))}getLiberties(t){if(!this.has(t)||this.get(t)===0)return[];let i=this.getChain(t),r=[],s={};for(let n of i){let l=this.getNeighbors(n).filter(a=>this.get(a)===0);r.push(...l.filter(a=>!(a in s))),l.forEach(a=>s[a]=!0)}return r}hasLiberties(t,i={}){let r=this.get(t);if(!this.has(t)||r===0||t in i)return!1;let s=this.getNeighbors(t);return s.some(n=>this.get(n)===0)?!0:(i[t]=!0,s.filter(n=>this.get(n)===r).some(n=>this.hasLiberties(n,i)))}clone(){let t=new Tt(this.signMap.map(i=>[...i])).setCaptures(1,this.getCaptures(1)).setCaptures(-1,this.getCaptures(-1));return t._koInfo=this._koInfo,t}diff(t){if(t.width!==this.width||t.height!==this.height)return null;let i=[];for(let r=0;r<this.width;r++)for(let s=0;s<this.height;s++){let n=t.get([r,s]);this.get([r,s])!==n&&i.push([r,s])}return i}stringifyVertex(t){return this.has(t)?tt[t[0]]+(this.height-t[1]):""}parseVertex(t){if(t.length<2)return[-1,-1];let i=tt.indexOf(t[0].toUpperCase()),r=this.height-+t.slice(1),s=[i,r];return this.has(s)?s:[-1,-1]}getHandicapPlacement(t,{tygem:i=!1}={}){if(Math.min(this.width,this.height)<=6||t<2)return[];let[r,s]=[this.width,this.height].map(_=>_>=13?3:2),[n,l]=[this.width-r-1,this.height-s-1],[a,o]=[this.width,this.height].map(_=>(_-1)/2),E=i?[[r,l],[n,s],[r,s],[n,l]]:[[r,l],[n,s],[n,l],[r,s]];return this.width%2!==0&&this.height%2!==0&&this.width!==7&&this.height!==7?(t===5&&E.push([a,o]),E.push([r,o],[n,o]),t===7&&E.push([a,o]),E.push([a,s],[a,l],[a,o])):this.width%2!==0&&this.width!==7?E.push([a,s],[a,l]):this.height%2!==0&&this.height!==7&&E.push([r,o],[n,o]),E.slice(0,t)}};V.fromDimensions=(h,t=null)=>{t==null&&(t=h);let i=[...Array(t)].map(r=>Array(h).fill(0));return new V(i)};var Zt=V;const Qt=Zt;var $t=Qt;const jt=ht($t);function qt(h,t){for(;;){const i=h.next();if(i.done)break;t(i.value)}}const Jt=h=>({date:h.DT[0],size:parseInt(h.SZ[0]),white:{name:h.PW[0],rank:h.WR?h.WR[0]:null},black:{name:h.PB[0],rank:h.BR?h.BR[0]:null},result:h.RE?h.RE[0]:null});function At(h){const t=i=>h.charCodeAt(i)-97;return[t(0),t(1)]}function te(h){let t,i;if("W"in h)t=1,i=h.W;else if("B"in h)t=-1,i=h.B;else throw"Unknown event: "+h;return i.length>0?[t,At(i[0])]:[t,null]}const P="0123456789abcdefghijklmnopqrstuvwxyz";function ee(h,t){return h.map(i=>{const[r,s]=At(i);let n=P.length;if(i[2]==":"){const l=i.slice(3),a=P.indexOf(l);a>-1?n=a:console.log("Unknown mark",i)}else console.log("Unknown tag?",i);return[r+s*t,n+1]})}const ie=h=>{let t=(u=>()=>u++)(0),s=lt.parse(h,{getId:t}).map(u=>new zt({getId:t,root:u}))[0].listNodesHorizontally(0,1);const n=s.next().value.data,l=Jt(n);let a=jt.fromDimensions(l.size);const o=(u,T)=>{const f={events:T};return u.C&&(f.comment=document.createTextNode(u.C)),u.LB&&(f.marks=ee(u.LB,l.size)),f},_=[o(n,[])];return qt(s,u=>{const[T,f]=te(u.data),x=[];if(f!==null){const d=a.makeMove(T,f,{preventOverwrite:!0,preventSuicide:!0,preventKo:!0});a.diff(d).forEach(m=>{x.push([m[0]+m[1]*l.size,a.get(m),d.get(m)])}),a=d}else console.log(T+": PASS");_.push(o(u.data,x))}),_.forEach((u,T)=>{if(u.comment){const f=u.comment.textContent.match(/\b[WB][0-9]+\b/g);f&&(u.marks||(u.marks=[]),f.map(x=>parseInt(x.slice(x[0]=="W"||x[0]=="B"?1:0))).sort().forEach(x=>{const d=_[x];d&&d.events.forEach(([m,N,C])=>{C!=0&&u.marks.push([m,ct(x)])})}))}}),[l,_]},Rt=`
        layout(std140) uniform Scene {
          vec4  grid;
          vec4  hoshi;
          vec4  black;
          vec4  white;
          float size;
        } scene;
`,re=`#version 300 es
        layout(location=0) in vec2 position;
        void main() {
            gl_Position = vec4(position, 1, 1);
        }
`,se=`#version 300 es
        precision highp float;
        ${Rt}
        out vec4 fragColor;
        void main() {
            fragColor = scene.grid;
        }
`;function et(h){const t=2/(h+1),i=new Float32Array(h*2*4),r=(s,n,l,a,o)=>{i[s]=n,i[s+1]=l,i[s+2]=a,i[s+3]=o};for(let s=0;s<h*2;s++){const n=s*4,l=t-1,a=t+s%h*t-1;s<h?r(n,l,a,1-t,a):r(n,a,l,a,1-t)}return i}const ne=`#version 300 es
        uniform float iTime;
        uniform int iLast;
        ${Rt}

        layout(location=0) in vec2 position;
        layout(location=1) in vec3 data;
        #define ITEM data.x
        #define TS data.y
        #define MARK data.z

        out vec3 color;
        out float age;
        out float last;
        out float fade;
        out float mark;

        void main() {
          mark = MARK;
          if (ITEM == 2.0 && mark == 0.0) {
            // hoshi without a mark
            gl_PointSize = scene.size * 0.25;
            color = scene.hoshi.xyz;
            age = 100.0;
            gl_Position = vec4(position, 0., 1.);
          } else if (ITEM != 0. || MARK != 0.) {
            if (ITEM == 1.0) {
              color = scene.white.xyz;
            } else if (ITEM == -1.0) {
              color = scene.black.xyz;
            } else {
              color = vec3(0);
            }
            if (TS < 0.) {
              fade = pow(clamp(0., 1., (iTime + TS) * 3.), 2.);
              age = 100.0;
            } else {
              age = (iTime - TS) * 9.;
            }
            if (age > 0.0) {
              last = iLast == gl_VertexID ? 1.0 : 0.0;
              gl_PointSize = scene.size;
              gl_Position = vec4(position, 0., 1.);
            }
        }
}
`,ft=P.length,I=60*window.devicePixelRatio,O=I*ft;function it(){var h=document.createElement("canvas");h.width=O,h.height=I;var t=h.getContext("2d",{antialias:!1});t.textAlign="center",t.textBaseline="middle",t.fillStyle="#ddd";for(let s=0;s<P.length;s++)s<10?t.font=`bold ${I}px sans-serif`:t.font=`${I*.5}px sans-serif`,t.fillText(P[s],I/2+s*I,I/2);const i=t.getImageData(0,0,O,I).data,r=new Uint8ClampedArray(O*I);for(let s=0;s<O*I;s++)r[s]=i[s*4+3];return r}function ct(h){if(h<10)return h+1;if(h<100)return h+100;if(h<1e3)return h+200}const ae=`#version 300 es
        precision highp float;
        uniform sampler2D tex;
        in vec3 color;
        in float age;
        in float last;
        in float fade;
        in float mark;
        out vec4 fragColor;

        vec2 remap(vec2 p, float start, float end) {
           if (p.x >= start && p.x <= end && p.y >= start && p.y <= end) {
             return (p - vec2(start)) * (1. / (end - start));
           } else {
             return vec2(-1.);
           }
        }

        void main() {
          float tx = 0.0;
          float ty = 0.0;
          if (mark < 11.0) {
            // 1 digit
            vec2 coord = remap(gl_PointCoord.xy, 0.25, 0.75);
            if (coord != vec2(-1.)) {
            tx = mark - 1. + coord.x;
            ty = coord.y;

          }} else if (mark >= 200.0) {
            // 3 digit
            tx = mark - 200.;
            float split = 1./3.;
            ty = (gl_PointCoord.y - split) * 2.5;
            if (gl_PointCoord.x <= split) {
                // first digit
                tx = floor(tx / 100.);
                tx += (gl_PointCoord.x - 0.05) * 3.;
            } else if (gl_PointCoord.x <= 2.*split){
                // second digit
                tx = floor(mod(tx, 100.) / 10.);
                tx += (gl_PointCoord.x - split) * 3.;
            } else  {
                // thrid digit
                tx = mod(tx, 10.);
                tx += (gl_PointCoord.x - (2.*split) + 0.05) * 3.;
              }
          } else if (mark >= 100.0) {
            // 2 digit numbers
            tx = mark - 100.;
            if (gl_PointCoord.y > 0.25 && gl_PointCoord.y < 0.75) {
              ty = (gl_PointCoord.y - 1./3.) * 2.5;
              if (gl_PointCoord.x <= 0.5) {
                // first digit
                tx = floor(tx / 10.);
                tx += (gl_PointCoord.x - 0.1) * 2.;
              } else {
                // second digit
                tx = mod(tx, 10.);
                tx += (gl_PointCoord.x - 0.4) * 2.;
              }
          }} else {
            tx = mark - 1.0 + gl_PointCoord.x;
            ty = gl_PointCoord.y;
          }
          vec2 tcoord = vec2(tx/(${ft}.0), ty);
          float scol = texture(tex, tcoord).r;

          // fragColor = vec4(gl_PointCoord.xy, 0., 1.);
          // fragColor = vec4(texture(tex, tcoord).rgb, 1.0);
          // return;

          if (color == vec3(0.0) && mark != 0.0) {
            // Just a mark, display the texture
            fragColor = vec4(.9, .9, .9, scol);
            return;
          }

          vec3 col = vec3(0.0);
          float blend = scol;
          float dist = length(gl_PointCoord.xy - .5);
          if (dist < min(0.48, age/(1.+ age))) {
            blend = 1.-smoothstep(0.42,0.48,dist);
            col += color;
            col += last * (vec3(1.) - color) * smoothstep(0.33,0.5,dist);
          }
          if (mark != 0.0)
            // Add the mark
            col = mix(col, vec3(.9), scol);
          fragColor = vec4(col, blend * (1.0 - fade));
        }
`;function rt(h){const t=2/(h+1),i=h*h,r=new Float32Array(i*2),s=(n,l,a)=>{r[n]=l,r[n+1]=a};for(let n=0;n<i;n++){const l=Math.floor(n/h),a=n%h;s(n*2,t+a*t-1,t+(h-l-1)*t-1)}return r}class he{constructor(t,i){this.app=g.createApp(t.getContext("webgl2")),this.font=this.app.createTexture2D(it(),O,I,{internalFormat:g.R8,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE,minFilter:g.NEAREST}),this.gridArrays=this.app.createVertexArray(),this.stoneArrays=this.app.createVertexArray(),this.sceneUB=this.app.createUniformBuffer([g.FLOAT_VEC4,g.FLOAT_VEC4,g.FLOAT_VEC4,g.FLOAT_VEC4,g.FLOAT]),this.colorsMap=i,this.attr=new Float32Array(3).fill(0),this.mark=new Float32Array(1),this.sz=0,this.move=0,this.moves=[],this.app.createPrograms([re,se],[ne,ae]).then(([r,s])=>{this.gridProgram=r,this.stoneProgram=s,this.drawGrid=this.app.createDrawCall(r,this.gridArrays).primitive(g.LINES).uniformBlock("Scene",this.sceneUB),this.drawStones=this.app.createDrawCall(s,this.stoneArrays).primitive(g.POINTS).uniformBlock("Scene",this.sceneUB).texture("tex",this.font),this.sz>0&&this.draw()}),this.app.onContextRestored(this.restore.bind(this)),globalThis.app=this.app}restore(){console.log("Restoring the context!"),this.gridArrays.restore(),this.stoneArrays.restore(),this.sceneUB.restore(),this.app.restorePrograms(this.gridProgram,this.stoneProgram),this.gridPositionsBuffer.restore(et(this.sz)),this.stonePositionsBuffer.restore(rt(this.sz)),this.stoneDataBuffer.restore(this.mkStoneData()),this.font.restore(it());for(let t=0;t<=this.move;t++)this.moves[t].events.forEach(([i,r,s])=>{this.setStone(i,s,Math.abs(s),0),s!=0&&(this.last=i)});this.setMarks(this.move),this.setupGPU()}draw(t){this.drawGrid&&(t||(t=performance.now()),this.app.clear(),this.drawGrid.draw(),this.drawStones.uniform("iTime",t/1e3).uniform("iLast",this.last),this.drawStones.draw())}resize(t){this.dim=t*window.devicePixelRatio,this.app.resize(this.dim,this.dim),this.app.canvas.style.width=t+"px",this.app.canvas.style.height=t+"px",this.sz>0&&(this.sceneUB.set(4,this.dim/(this.sz+1)).update(),this.draw())}setStone(t,i,r,s){const n=12*t;this.attr[0]=i,r==0&&(s*=-1,this.hoshis.indexOf(t)>-1&&(this.attr[0]=2)),this.attr[1]=s/1e3,this.stoneDataBuffer.data(this.attr,n)}setMarks(t,i){i!=null&&this.moves[i].marks&&this.moves[i].marks.forEach(([r,s])=>{this.setMark(r,0)}),t!=null&&this.moves[t].marks&&this.moves[t].marks.forEach(([r,s])=>{this.setMark(r,s)})}setMark(t,i){const r=12*t;this.mark[0]=i,this.stoneDataBuffer.data(this.mark,r+8)}setNumber(t,i){this.setMark(t,ct(i))}setupGPU(){this.app.clearColor(0,0,0,0).enable(g.BLEND).blendEquation(g.FUNC_ADD).blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),this.sceneUB.set(0,this.colorsMap.grid).set(1,this.colorsMap.hoshi).set(2,this.colorsMap.black).set(3,this.colorsMap.white).set(4,this.dim/(this.sz+1)).update(),this.gridArrays.vertexAttributeBuffer(0,this.gridPositionsBuffer),this.stoneArrays.vertexAttributeBuffer(0,this.stonePositionsBuffer).vertexAttributeBuffer(1,this.stoneDataBuffer),this.draw()}demoBoard(){for(let t=0;t<this.sz*this.sz;t++)t%15<=2&&this.setStone(t,t%2==0?1:-1,1,0),this.setNumber(t,t+91)}mkStoneData(t,i){const r=this.sz*this.sz,s=new Float32Array(r*3).fill(0);this.hoshis=[];for(let n=0;n<3;n++)for(let l=0;l<3;l++){const a=this.hoshiStart+n*this.hoshiSpacing+this.sz*(this.hoshiStart+l*this.hoshiSpacing);this.hoshis.push(a),s[a*3]=2}return s}initialize(t,i){this.dim||this.resize(this.app.gl.canvas.width),this.hoshiStart=t==9?2:3,this.hoshiSpacing=t==9?2:t==13?4:6,this.moves=i,this.move=0,t!=this.sz?(this.sz=t,this.gridPositionsBuffer=this.app.createVertexBuffer(g.FLOAT,2,et(t)),this.stonePositionsBuffer=this.app.createVertexBuffer(g.FLOAT,2,rt(t)),this.stoneDataBuffer=this.app.createVertexBuffer(g.FLOAT,3,this.mkStoneData()),this.setupGPU()):this.stoneDataBuffer.data(this.mkStoneData())}}const le=`<style>
  :host {
    /* Black stone colors */
    --clr-black: var(--wv-color-black, #765aff);
    /* White stone colors */
    --clr-white: var(--wv-color-white, #e32881);
    /* Hoshi colors */
    --clr-hoshi: var(--wv-color-hoshi, #ffa331);
    /* Grid lines colors */
    --clr-grid: var(--wv-color-grid, #333333);

    /* The main background */
    --clr-bg: var(--wv-color-bg, #111);
    /* UI backdrop */
    --clr-bg2: var(--wv-color-bg2, #222);
    /* UI color */
    --clr-fg: var(--wv-color-fg, #ddd);
    /* UI button colors */
    --clr-bg-btn: var(--wv-color-btn, #666);
    --clr-over-btn: var(--wv-color-btn-over, #888);

    display: inline-block;
    overflow: hidden;
    overflow-x: hidden;    overflow-y: hidden;
  }
  * {
    margin: 0;
    padding: 0;
    background-color: var(--clr-bg);
    color: var(--clr-fg);
    touch-action: manipulation;
  }

  #root {
    display: flex;
    flex-direction: row;
    height: 100%;
    width: 100%;
    align-items: center;
    place-content: center;
  }

  #controllers {
    display: inline-flex;
    align-items: center;
  }
  #render {
    flex-grow: 1;
  }
  #board {
    display: inline-block;
  }
  div#top {
    width: 100%;
    place-content: center;
    display: flex;
  }

  div#players {
    padding: 5px;
    display: grid;
    gap: 7px;
    align-items: center;
    font-weight: bold;
  }

  div#players > div {
    padding: 8px 12px;
    border-radius: 8px;
  }

  div#player-black {
    background-color: var(--clr-bg2);
    color: var(--clr-black)
  }

  div#comment {
    width: 95%;
    padding: 8px 8px;
    /* text-align: justify; */
    height: 100%;
    overflow-y: auto;
  }

  div#player-white {
    background-color: var(--clr-bg2);
    color: var(--clr-white)
  }

  button, select {
    border-color: var(--clr-bg2);
    background-color: var(--clr-bg-btn);
    color: var(--clr-fg);
    font-weight: 800;
    border-radius: 3px;
    width: 28px;
    height: 20px;
    font-family: monospace;
    cursor: pointer;
  }

  button:hover, select:hover {
    background-color: var(--clr-over-btn);
  }

  select {
    font-size: 0.9em;
    width: 33px;
    appearance: none;
    -moz-appearance: none;
    -webkit-appearance: none;
  }

  input[type="range"] {
    -webkit-appearance: none;
    flex-grow: 1;
    background: var(--clr-bg2);
    outline: none;
    cursor: pointer;
  }

  /* slider thumb */
  input[type="range"]::-webkit-slider-thumb, input[type="range"]::-moz-range-thumb {
    -webkit-appearance: none;
    appearance: none;
    height: 15px;
    width: 15px;
    background-color: #eee;
    border-radius: 50%;
    border: none;
  }
</style>
<div id="root">
  <div id="top">
  <div id="players">
    <div id="player-black">Blacky</div>
    <bold id="player-status">VS</bold>
    <div id="player-white">Whitey</div>
  </div>
  </div>
  <canvas id="board"></canvas>
  <div id="controllers">
    <input id="slider" type="range" min="0" max="255" value="0" />
    <select id="speed">
      <option id="custom" style="display: none"></option>
      <option value="0.1">x0.1</option>
      <option value="0.2">x0.2</option>
      <option value="0.5">x0.5</option>
      <option value="1" selected>x1</option>
      <option value="2">x2</option>
      <option value="4">x4</option>
      <option value="8">x8</option>
      <option value="16">x16</option>
    </select>
    <button id="prev">&lt;</button>
    <button id="play">0</button>
    <button id="next">&gt;</button>
  </div>
  <div id="comment">
    comment
  </div>
</div>
`,dt=document.createElement("template");dt.innerHTML=le;class St extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(dt.content.cloneNode(!0)),this.orientation=null,this.playing=!1,this.speed=1,this.propMove=0,this.board=this.shadowRoot.getElementById("board"),this.comment=this.shadowRoot.getElementById("comment"),this.display=new he(this.board,oe(window.getComputedStyle(this))),this.setupControllers(),this.root=this.shadowRoot.getElementById("root"),this.top=this.shadowRoot.getElementById("top"),this.players=this.shadowRoot.getElementById("players"),this.playersStatus=this.shadowRoot.getElementById("player-status"),this.playerBlack=this.shadowRoot.getElementById("player-black"),this.playerWhite=this.shadowRoot.getElementById("player-white"),this.controllers=this.shadowRoot.getElementById("controllers"),this.resizeObserver=new ResizeObserver(t=>{const i=t[0];this.handleResize(i.contentRect.width,i.contentRect.height)}),this.resizeObserver.observe(this)}disconnectedCallback(){this.resizeObserver.disconnect()}attributeChangedCallback(t,i,r){t==="move"?(this.propMove=parseInt(r),this.display.moves.length>0&&this.setMove(this.propMove)):t==="sgf"?this.initialize(r):t=="autoplay"?this.playing=!0:t=="speed"?this.setSpeed(parseFloat(r)):t=="href"&&fetch(r).then(s=>s.text()).then(s=>this.initialize(s))}setupControllers(){const t=this.shadowRoot,i=s=>{this.stopPlaying();const n=s.target.textContent==">"?1:-1;this.setMove(this.display.move+n)};t.getElementById("prev").onclick=i,t.getElementById("next").onclick=i,this.slider=t.getElementById("slider"),this.slider.oninput=s=>{this.setMove(parseInt(s.target.value),"slider")};const r=()=>{this.display.move+1>=this.display.moves.length?(this.setMove(0),this.playing=!0,this.startPlaying()):(this.playing=!this.playing,this.startPlaying(!0)),!this.playing&&this.timer&&clearTimeout(this.timer)};this.play=t.getElementById("play"),this.play.onclick=r,this.board.onclick=r,this.speedSelector=t.getElementById("speed"),this.speedCustom=t.getElementById("custom"),this.speedSelector.onchange=s=>{this.speed=parseFloat(s.target.value),this.startPlaying()},this.speedSelector.onwheel=s=>{this.setSpeed(this.speed-s.deltaY/(this.speed>=10?100:1e3))},this.board.onwheel=s=>{this.stopPlaying(),this.setMove(this.display.move+Math.floor(s.deltaY/126))}}setSpeed(t){this.speed=Math.max(.001,t),this.speedCustom.value=this.speed,this.speedCustom.innerHTML="x"+this.speed.toFixed(this.speed>=10?0:1),this.speedCustom.style.display="block",this.speedSelector.selectedIndex=0}initialize(t){const[i,r]=ie(t);this.display.initialize(i.size,r),this.playerBlack.innerHTML=i.black.name+" (B)",this.playerWhite.innerHTML=i.white.name+" (W)",this.slider.max=r.length-1,this.result=document.createTextNode("Result: "+i.result),this.setMove(this.propMove),this.startPlaying()}startPlaying(t){if(this.playing){this.speed>1&&(this.comment.innerHTML="",this.display.setMarks(null,this.display.move)),t&&this.setMove(this.display.move+1),this.timer&&clearTimeout(this.timer);const i=this.comment.textContent,r=Math.min(5e3,Math.max(1e3,i?i.split(/\s+/).length*200:0));this.timer=setTimeout(()=>this.startPlaying(!0),r/this.speed)}}stopPlaying(){this.playing=!1,this.timer&&clearTimeout(this.timer)}animate(){if(this.drawingStart=performance.now(),this.animating)return;this.animating=!0;const t=()=>{const i=performance.now();this.display.draw(i),i-this.drawingStart>1e3?this.animating=!1:requestAnimationFrame(t)};t()}setMove(t,i){if(t<0||t>=this.display.moves.length){this.playing=!1;return}let r=performance.now(),s=this.display.move+1,n=t+1,l=Math.sign(n-s);l<0&&(s--,n--);const a=200/Math.abs(n-s);for(let o=s;o!=n;o+=l)this.display.moves[o].events.forEach(([E,_,u])=>{let T=u,f=T==0?_:u;l<0&&(T=_,f=T),this.display.setStone(E,f,Math.abs(T),r)}),r+=a;if(this.display.moves[t].events.forEach(([o,E,_])=>{_!=0&&(this.display.last=o)}),!this.playing||this.playing&&this.speed==1){this.display.setMarks(t,this.display.move);const o=this.display.moves[t];o.comment?this.comment.replaceChildren(o.comment):this.comment.innerHTML=""}t+1==this.display.moves.length?(this.playersStatus.innerHTML="",this.playersStatus.append(this.result)):this.display.move+1==this.display.moves.length&&(this.playersStatus.innerHTML="VS"),this.display.move=t,this.play.innerHTML=t,i!=="slider"&&(this.slider.value=t),this.animate()}handleResize(t,i){const r=Math.min(t,i),n=i-r>=20?"horizontal":"vertical";this.orientation!=n&&(n=="vertical"?(this.root.style["flex-direction"]="row",this.top.style["flex-direction"]="column",this.top.style.height="100%",this.top.style["place-content"]=null,this.players.style["flex-direction"]="column",this.controllers.style["flex-direction"]="column",this.controllers.style.width="28px",this.controllers.style.height="100%",this.slider.style.margin="8px 0",this.slider.style["writing-mode"]="vertical-lr",this.top.appendChild(this.comment)):(this.root.style["flex-direction"]="column",this.top.style["flex-direction"]="row",this.top.style.height=null,this.top.style["place-content"]="center",this.players.style["flex-direction"]="row",this.controllers.style["flex-direction"]="row",this.controllers.style.width="100%",this.controllers.style.height="20px",this.slider.style.margin="0 8px",this.slider.style["writing-mode"]="horizontal-tb",this.root.appendChild(this.comment)),this.orientation=n),n=="vertical"&&t-r<160||n=="horizontal"&&i-r<60?(this.players.style.display="none",this.comment.style.display="none"):(this.players.style.display="flex",this.comment.style.display="block"),r<169?this.slider.style.display="none":this.slider.style.display="block",this.display.resize(r)}}z(St,"observedAttributes",["href","move","autoplay","speed","sgf"]);function oe(h){const t=i=>{const r=h.getPropertyValue(i);let s=r.match(/^#([0-9a-f]{3})$/i);if(s)return[parseInt(s[1].charAt(0),16)*17/255,parseInt(s[1].charAt(1),16)*17/255,parseInt(s[1].charAt(2),16)*17/255,1];if(s=r.match(/^#([0-9a-f]{6})$/i),s)return[parseInt(s[1].substr(0,2),16)/255,parseInt(s[1].substr(2,2),16)/255,parseInt(s[1].substr(4,2),16)/255,1];throw i+": unsupported color: "+r+", only #rrggbb is supported"};return{black:t("--clr-black"),white:t("--clr-white"),hoshi:t("--clr-hoshi"),grid:t("--clr-grid")}}customElements.define("weiqi-visualizer",St);const Y=document.getElementById("sgfFile");Y.onchange=()=>{const h=new FileReader;h.onload=t=>{document.getElementById("game-of-the-century").setAttribute("sgf",t.target.result)},h.readAsText(Y.files[0])};const Ee=document.getElementById("loadButton");Ee.onclick=()=>{Y.click()};
